<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Vinícius Maia e Augusto Schmidt" />

<meta name="date" content="2020-09-10" />

<title>Aula 3</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Oficina de R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutoriais
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="11_lingua-r.html">Falando a língua do R</a>
    </li>
    <li>
      <a href="12_bancos-de-dados-em-r.html">Banco de dados</a>
    </li>
    <li>
      <a href="13_controle-de-fluxo.html">Controle de fluxo</a>
    </li>
    <li>
      <a href="14_visualizacoes-em-R.html">Visualizações</a>
    </li>
    <li>
      <a href="15_manipulacao-dplyr.html">Manipulação com dplyr</a>
    </li>
    <li>
      <a href="16_tidy_data.html">Reformatando com tidyr</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Curso
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00_aula-1.html">Aula 1: Introdução</a>
    </li>
    <li>
      <a href="02_aula-2.html">Aula 2: Importação e cozinha</a>
    </li>
    <li>
      <a href="03_aula-3.html">Aula 3: Transformação e visualização</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Aula 3</h1>
<h4 class="author">Vinícius Maia e Augusto Schmidt</h4>
<h4 class="date">2020-09-10</h4>

</div>


<div id="introdução" class="section level1">
<h1>Introdução</h1>
<p>O foco da aula de hoje é a produção de visualizações. Vamos estudar formas de transformar nossos dados em visualizações. Isto envolve um processo inicial de transformação dos dados e, posteriormente, podemos “mapear” os valores do dados para elementos visuais. Vamos começar.</p>
</div>
<div id="visualizações-básicas" class="section level1">
<h1>Visualizações básicas</h1>
<p>Vamos ver algumas formas de mapear os nossos dados para o espaço visual, mas, para isso, precisamos entender a “gramática” dos gráficos. Vejam a imagem a seguir, retirada do livro <a href="https://ggplot2-book.org">ggplot2: Elegant Graphics for Data Analysis</a>, de Hadley Wickham</p>
<p><img src="scale-guides.png" /><!-- --></p>
<p>Um gráfico é uma forma de mapear os dados em um sistema de medidas. Por exemplo, se eu tenho duas variáveis numéricas, como “Idade” e “Renda per capita”, eu posso mapear os valores para um eixo de coordenadas cartesianas (do tipo x,y) e, para cada uma das observações do meu banco, eu desenho um ponto na posição indicada pelos eixos X e Y. Isso é um scatterplot clássico.</p>
<div id="scatterplots" class="section level2">
<h2>Scatterplots</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">censo &lt;-<span class="st"> </span><span class="kw">read_csv2</span>(<span class="st">&quot;censo_sc.csv.xz&quot;</span>)</a></code></pre></div>
<pre><code>## Using &#39;,&#39; as decimal and &#39;.&#39; as grouping mark. Use read_delim() for more control.</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   mun7 = col_double(),
##   areap = col_double(),
##   controle = col_double(),
##   peso = col_double(),
##   sexo = col_character(),
##   idade = col_double(),
##   nv_inst = col_character(),
##   renda_pc = col_double(),
##   ge_pia = col_character()
## )</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Primeiro vamos recortar nossos dados para evitar que os outliers atrapalhem a visualização da tendência.</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">summary</span>(censo)</a></code></pre></div>
<pre><code>##       mun7             areap                  controle            peso       
##  Min.   :4200051   Min.   :4200051001000   Min.   :      4   Min.   : 1.000  
##  1st Qu.:4204459   1st Qu.:4204459001000   1st Qu.:1536221   1st Qu.: 3.850  
##  Median :4208906   Median :4208906003000   Median :3076208   Median : 6.442  
##  Mean   :4209098   Mean   :4209097653860   Mean   :3087090   Mean   : 7.164  
##  3rd Qu.:4213500   3rd Qu.:4213500001000   3rd Qu.:4634493   3rd Qu.:10.174  
##  Max.   :4219853   Max.   :4219853001000   Max.   :6192309   Max.   :52.230  
##                                                                              
##      sexo               idade          nv_inst             renda_pc       
##  Length:872242      Min.   :  0.00   Length:872242      Min.   :     0.0  
##  Class :character   1st Qu.: 16.00   Class :character   1st Qu.:   353.3  
##  Mode  :character   Median : 30.00   Mode  :character   Median :   591.7  
##                     Mean   : 32.69                      Mean   :   895.6  
##                     3rd Qu.: 47.00                      3rd Qu.:   989.0  
##                     Max.   :132.00                      Max.   :520000.0  
##                                                         NA&#39;s   :2805      
##     ge_pia         
##  Length:872242     
##  Class :character  
##  Mode  :character  
##                    
##                    
##                    
## </code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">censo2 &lt;-<span class="st"> </span>censo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(renda_pc) <span class="op">&amp;</span><span class="st"> </span>renda_pc <span class="op">&lt;</span><span class="st"> </span><span class="dv">20000</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co"># r base</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">with</span>(</a>
<a class="sourceLine" id="cb6-5" title="5">  censo2,</a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="kw">plot.default</span>(<span class="dt">x =</span> idade, <span class="dt">y =</span> renda_pc, <span class="dt">type =</span> <span class="st">&quot;p&quot;</span>,</a>
<a class="sourceLine" id="cb6-7" title="7">       <span class="dt">main =</span> <span class="st">&quot;Scatterplot&quot;</span>,</a>
<a class="sourceLine" id="cb6-8" title="8">       <span class="dt">xlab =</span> <span class="st">&quot;Idade&quot;</span>,</a>
<a class="sourceLine" id="cb6-9" title="9">       <span class="dt">ylab =</span> <span class="st">&quot;Renda Per capita&quot;</span>)</a>
<a class="sourceLine" id="cb6-10" title="10">)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># ggplot2</span></a>
<a class="sourceLine" id="cb7-2" title="2">censo2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade, <span class="dt">y =</span> renda_pc)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Renda Per Capita&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Scatterplot&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot-2.png" width="672" /></p>
<p>Nosso mapeamento não produz uma visualização muito informativa, porque há muitos pontos no gráfico, o que nos dificulta distinguir onde estão as tendências. Esse tipo de problema é conhecido como “overplotting”. Há muitas soluções distintas para esse problema. Uma delas, é a gente deixar os pontos mais translúcidos, para que as zonas onde há mais pontos se destaquem em relação a onde há poucos pontos.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">library</span>(scales)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;scales&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     discard</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     col_factor</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># r base</span></a>
<a class="sourceLine" id="cb12-2" title="2">color &lt;-<span class="st"> </span><span class="kw">rgb</span>(<span class="dt">red =</span> <span class="dv">0</span>, <span class="dt">green =</span> <span class="dv">0</span>, <span class="dt">blue =</span> <span class="dv">0</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw">with</span>(</a>
<a class="sourceLine" id="cb12-5" title="5">  censo2,</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw">plot.default</span>(<span class="dt">x =</span> idade, <span class="dt">y =</span> renda_pc, <span class="dt">type =</span> <span class="st">&quot;p&quot;</span>,</a>
<a class="sourceLine" id="cb12-7" title="7">       <span class="dt">main =</span> <span class="st">&quot;Scatterplot&quot;</span>,</a>
<a class="sourceLine" id="cb12-8" title="8">       <span class="dt">xlab =</span> <span class="st">&quot;Idade&quot;</span>,</a>
<a class="sourceLine" id="cb12-9" title="9">       <span class="dt">ylab =</span> <span class="st">&quot;Renda Per capita&quot;</span>,</a>
<a class="sourceLine" id="cb12-10" title="10">       <span class="dt">col =</span> color)</a>
<a class="sourceLine" id="cb12-11" title="11">)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot2-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># ggplot2</span></a>
<a class="sourceLine" id="cb13-2" title="2">censo2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade, <span class="dt">y =</span> renda_pc)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Renda Per Capita&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Scatterplot&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot2-2.png" width="672" /></p>
<p>Um pouco melhor, podemos ver que a nuvem é um pouco mais alta e mais densa nas idades produtivas, mas ainda está muito poluído. E se a gente retirasse uma medida resumo para cada município? Reduziriamos o número de pontos e talvez pudessemos ter uma noção mais clara. Pode ser a média de idade e a média da renda per capita.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">medias &lt;-<span class="st"> </span>censo2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(mun7) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb14-4" title="4">    <span class="dt">idade_media =</span> <span class="kw">mean</span>(idade),</a>
<a class="sourceLine" id="cb14-5" title="5">    <span class="dt">renda_pc_med =</span> <span class="kw">mean</span>(renda_pc)                          </a>
<a class="sourceLine" id="cb14-6" title="6">  )</a></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># r base</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">with</span>(</a>
<a class="sourceLine" id="cb16-3" title="3">  medias,</a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="kw">plot.default</span>(<span class="dt">x =</span> idade_media, <span class="dt">y =</span> renda_pc_med, <span class="dt">type =</span> <span class="st">&quot;p&quot;</span>,</a>
<a class="sourceLine" id="cb16-5" title="5">       <span class="dt">main =</span> <span class="st">&quot;Scatterplot&quot;</span>,</a>
<a class="sourceLine" id="cb16-6" title="6">       <span class="dt">xlab =</span> <span class="st">&quot;Idade&quot;</span>,</a>
<a class="sourceLine" id="cb16-7" title="7">       <span class="dt">ylab =</span> <span class="st">&quot;Renda Per capita&quot;</span>)</a>
<a class="sourceLine" id="cb16-8" title="8">)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot3-1.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># ggplot2</span></a>
<a class="sourceLine" id="cb17-2" title="2">medias <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade_media, <span class="dt">y =</span> renda_pc_med)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Renda Per Capita&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Scatterplot&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot3-2.png" width="672" /></p>
<p>Agora sim. Em geral, nossa nuvem de pontos não deve ser muito densa, se não a gente não consegue distinguir as feições do nosso grupo de dados. Para isso, podemos recorrer tanto a técnicas visuais, quanto a transformações nos dados.</p>
<p>Mas não é só isso. Além de mapear valores para eixos, podemos também mapear valores para outros atributos estéticos. Por exemplo, podemos mapear o sexo da pessoa para as cores dos pontos.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">medias_sexo &lt;-<span class="st"> </span>censo2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(mun7, sexo) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb18-4" title="4">    <span class="dt">idade_media =</span> <span class="kw">mean</span>(idade),</a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="dt">renda_pc_med =</span> <span class="kw">mean</span>(renda_pc)                          </a>
<a class="sourceLine" id="cb18-6" title="6">  )</a></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;mun7&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># r base</span></a>
<a class="sourceLine" id="cb20-2" title="2">color &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Feminino&quot;</span> =<span class="st"> &quot;red&quot;</span>, <span class="st">&quot;Masculino&quot;</span> =<span class="st"> &quot;blue&quot;</span>)</a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="kw">with</span>(</a>
<a class="sourceLine" id="cb20-5" title="5">  medias_sexo,</a>
<a class="sourceLine" id="cb20-6" title="6">  {</a>
<a class="sourceLine" id="cb20-7" title="7">  <span class="kw">plot.default</span>(<span class="dt">x =</span> idade_media, <span class="dt">y =</span> renda_pc_med, <span class="dt">type =</span> <span class="st">&quot;p&quot;</span>,</a>
<a class="sourceLine" id="cb20-8" title="8">       <span class="dt">main =</span> <span class="st">&quot;Scatterplot&quot;</span>,</a>
<a class="sourceLine" id="cb20-9" title="9">       <span class="dt">xlab =</span> <span class="st">&quot;Idade&quot;</span>,</a>
<a class="sourceLine" id="cb20-10" title="10">       <span class="dt">ylab =</span> <span class="st">&quot;Renda Per capita&quot;</span>,</a>
<a class="sourceLine" id="cb20-11" title="11">       <span class="dt">col =</span> color)</a>
<a class="sourceLine" id="cb20-12" title="12">  <span class="kw">legend</span>(<span class="dt">x =</span> <span class="st">&quot;topleft&quot;</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Feminino&quot;</span>, <span class="st">&quot;Masculino&quot;</span>), <span class="dt">fill =</span> color)  </a>
<a class="sourceLine" id="cb20-13" title="13">  }</a>
<a class="sourceLine" id="cb20-14" title="14">)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot4-1.png" width="672" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># ggplot2</span></a>
<a class="sourceLine" id="cb21-2" title="2">medias_sexo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade_media, <span class="dt">y =</span> renda_pc_med, <span class="dt">color =</span> sexo)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Renda Per Capita&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Scatterplot&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/scatterplot4-2.png" width="672" /></p>
<p>Legal, né?</p>
</div>
<div id="lines" class="section level2">
<h2>Lines</h2>
<p>Gráficos de linhas são uma forma interessante de verificar alterações em alguma variável ao longo do tempo, por exemplo. São a forma preferencial de visualizar séries temporais. Em geral, eu evito tentar produzir séries temporais a partir de microdados, dá um trabalhão! Podemos conseguir séries temporais no IBGE, no SIDRA, por exemplo. O gráfico de linhas é muito similar ao de pontos, mas os pontos são conectados por linhas para indicar que pertencem todos ao mesmo grupo.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">library</span>(sidrar)</a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">search_sidra</span>(<span class="st">&quot;Fecundidade&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Tabela 1163 - Taxa de fecundidade total por situação do domicílio (série encerrada)&quot;
## [2] &quot;Tabela 3727 - Taxa de fecundidade total&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">info_sidra</span>(<span class="dv">1163</span>) <span class="co">#wb = TRUE</span></a></code></pre></div>
<pre><code>## $table
## [1] &quot;Tabela 1163: Taxa de fecundidade total por situação do domicílio (série encerrada)&quot;
## 
## $period
## [1] &quot;1992, 1993, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009&quot;
## 
## $variable
##    cod                          desc
## 1 2493 Taxa de fecundidade total (%)
## 
## $classific_category
## $classific_category$`c1 = Situação do domicílio (3):`
##    cod   desc
## 1 6795  Total
## 2    1 Urbana
## 3    2  Rural
## 
## 
## $geo
##      cod                      desc
## 1 Brazil                Brasil (1)
## 2 Region         Grande Região (5)
## 3  State Unidade da Federação (27)</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">fecun &lt;-<span class="st"> </span><span class="kw">get_sidra</span>(<span class="dt">x =</span> <span class="dv">1163</span>,</a>
<a class="sourceLine" id="cb26-2" title="2">                  <span class="dt">variable =</span> <span class="dv">2493</span>,</a>
<a class="sourceLine" id="cb26-3" title="3">                  <span class="dt">period =</span> <span class="st">&quot;all&quot;</span>,</a>
<a class="sourceLine" id="cb26-4" title="4">                  <span class="dt">classific =</span> <span class="st">&quot;C1&quot;</span>,</a>
<a class="sourceLine" id="cb26-5" title="5">                  <span class="dt">category =</span> <span class="kw">list</span>(<span class="dt">C1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb26-6" title="6">fecun &lt;-<span class="st"> </span>fecun <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">Situação do domicílio</span><span class="st">`</span>, Ano, Valor)</a>
<a class="sourceLine" id="cb26-7" title="7"></a>
<a class="sourceLine" id="cb26-8" title="8"><span class="co"># Mapeando a situação do domicílio para COR</span></a>
<a class="sourceLine" id="cb26-9" title="9">fecun <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-10" title="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Ano, <span class="dt">y =</span> Valor, <span class="dt">color =</span> <span class="st">`</span><span class="dt">Situação do domicílio</span><span class="st">`</span>, <span class="dt">group =</span> <span class="st">`</span><span class="dt">Situação do domicílio</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb26-11" title="11"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb26-12" title="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Ano&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Taxa de fecundidade total&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Lineplot COR&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/linhas-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># Mapeando a situação do domicílio para tipo de linha</span></a>
<a class="sourceLine" id="cb27-2" title="2">fecun <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Ano, <span class="dt">y =</span> Valor, <span class="dt">linetype =</span> <span class="st">`</span><span class="dt">Situação do domicílio</span><span class="st">`</span>, <span class="dt">group =</span> <span class="st">`</span><span class="dt">Situação do domicílio</span><span class="st">`</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-4" title="4"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Ano&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Taxa de fecundidade total&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Lineplot COR&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/linhas-2.png" width="672" /></p>
</div>
<div id="density-plots" class="section level2">
<h2>Density plots</h2>
<p>Parecido com o histograma, os density plots são uma forma de visualizar uma variável contínua através da sua distribuição de probabilidades.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">censo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade, <span class="dt">color =</span> sexo)) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">outline.type =</span> <span class="st">&quot;upper&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Probabilidade&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Density Plot&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/density-1.png" width="672" /></p>
</div>
<div id="barplots-and-histograms" class="section level2">
<h2>Barplots and Histograms</h2>
<p>Ao invés de probabilidades, podemos usar contagens e proporções, que são empilhadas no formato de barras para fazer histogramas e barplots.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">censo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade, <span class="dt">fill =</span> sexo)) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="dt">binwidth =</span> <span class="dv">5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Contagem&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Histograma&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/histogram-1.png" width="672" /></p>
<p>Num barplot, a altura das barras é proporcional ao número de casos em cada posição, similar ao histograma. A diferença é que ele não agrupa os valores. O legal é que ela vem com um argumento “weight”, que permite utilizar a ponderação pela variável peso.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">censo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb30-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade, <span class="dt">fill =</span> sexo, <span class="dt">weight =</span> peso)) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-3" title="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Contagem&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Barplot&quot;</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/barplot-1.png" width="672" /></p>
<p>O <code>ggplot2</code> tem mais um tipo de gráfico de barras, que é o <code>geom_col()</code>. Nesse caso, você tem que passar uma variável que já contenha a altura das barras, ele não calcula por você.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">proporcao &lt;-<span class="st"> </span>censo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="st">  </span><span class="kw">count</span>(sexo, idade, <span class="dt">wt =</span> peso) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> n<span class="op">/</span><span class="kw">sum</span>(n))</a>
<a class="sourceLine" id="cb31-4" title="4">proporcao</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["sexo"],"name":[1],"type":["chr"],"align":["left"]},{"label":["idade"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Feminino","2":"0","3":"39991.639229","4":"0.0064002638792"},{"1":"Feminino","2":"1","3":"38994.901088","4":"0.0062407458588"},{"1":"Feminino","2":"2","3":"39173.901457","4":"0.0062693930865"},{"1":"Feminino","2":"3","3":"39623.408869","4":"0.0063413322745"},{"1":"Feminino","2":"4","3":"41419.304266","4":"0.0066287474608"},{"1":"Feminino","2":"5","3":"41307.198286","4":"0.0066108060144"},{"1":"Feminino","2":"6","3":"41047.692041","4":"0.0065692746223"},{"1":"Feminino","2":"7","3":"41586.105281","4":"0.0066554423034"},{"1":"Feminino","2":"8","3":"42502.503794","4":"0.0068021027658"},{"1":"Feminino","2":"9","3":"47298.312283","4":"0.0075696241886"},{"1":"Feminino","2":"10","3":"49599.614073","4":"0.0079379246386"},{"1":"Feminino","2":"11","3":"48110.690684","4":"0.0076996372673"},{"1":"Feminino","2":"12","3":"51248.476884","4":"0.0082018087227"},{"1":"Feminino","2":"13","3":"52026.068432","4":"0.0083262545117"},{"1":"Feminino","2":"14","3":"53714.398274","4":"0.0085964549014"},{"1":"Feminino","2":"15","3":"55058.503363","4":"0.0088115655449"},{"1":"Feminino","2":"16","3":"54291.478467","4":"0.0086888108434"},{"1":"Feminino","2":"17","3":"51784.856873","4":"0.0082876510021"},{"1":"Feminino","2":"18","3":"53711.550660","4":"0.0085959991691"},{"1":"Feminino","2":"19","3":"54170.181208","4":"0.0086693984242"},{"1":"Feminino","2":"20","3":"55656.796836","4":"0.0089073164613"},{"1":"Feminino","2":"21","3":"55210.641408","4":"0.0088359137250"},{"1":"Feminino","2":"22","3":"55590.747182","4":"0.0088967458715"},{"1":"Feminino","2":"23","3":"54720.748007","4":"0.0087575111614"},{"1":"Feminino","2":"24","3":"57094.082260","4":"0.0091373396902"},{"1":"Feminino","2":"25","3":"55436.897441","4":"0.0088721237515"},{"1":"Feminino","2":"26","3":"55075.477641","4":"0.0088142821092"},{"1":"Feminino","2":"27","3":"57887.225794","4":"0.0092642744198"},{"1":"Feminino","2":"28","3":"57528.579029","4":"0.0092068765741"},{"1":"Feminino","2":"29","3":"54388.576872","4":"0.0087043504769"},{"1":"Feminino","2":"30","3":"56426.454948","4":"0.0090304925828"},{"1":"Feminino","2":"31","3":"51346.317314","4":"0.0082174671098"},{"1":"Feminino","2":"32","3":"50504.783147","4":"0.0080827879410"},{"1":"Feminino","2":"33","3":"47537.588542","4":"0.0076079179727"},{"1":"Feminino","2":"34","3":"49054.055517","4":"0.0078506134208"},{"1":"Feminino","2":"35","3":"48381.009446","4":"0.0077428990950"},{"1":"Feminino","2":"36","3":"46809.041615","4":"0.0074913212872"},{"1":"Feminino","2":"37","3":"47447.920613","4":"0.0075935675130"},{"1":"Feminino","2":"38","3":"47064.538495","4":"0.0075322110203"},{"1":"Feminino","2":"39","3":"46832.436188","4":"0.0074950653558"},{"1":"Feminino","2":"40","3":"47867.017382","4":"0.0076606397802"},{"1":"Feminino","2":"41","3":"45105.719905","4":"0.0072187215982"},{"1":"Feminino","2":"42","3":"47007.861466","4":"0.0075231404258"},{"1":"Feminino","2":"43","3":"45769.510438","4":"0.0073249546673"},{"1":"Feminino","2":"44","3":"48193.665877","4":"0.0077129166212"},{"1":"Feminino","2":"45","3":"48063.066133","4":"0.0076920154318"},{"1":"Feminino","2":"46","3":"46439.029184","4":"0.0074321044798"},{"1":"Feminino","2":"47","3":"45783.717345","4":"0.0073272283414"},{"1":"Feminino","2":"48","3":"42816.849917","4":"0.0068524107345"},{"1":"Feminino","2":"49","3":"42019.967379","4":"0.0067248776145"},{"1":"Feminino","2":"50","3":"41485.577920","4":"0.0066393538996"},{"1":"Feminino","2":"51","3":"37690.868152","4":"0.0060320483646"},{"1":"Feminino","2":"52","3":"38138.495962","4":"0.0061036867410"},{"1":"Feminino","2":"53","3":"35894.233481","4":"0.0057445148648"},{"1":"Feminino","2":"54","3":"34425.306833","4":"0.0055094277729"},{"1":"Feminino","2":"55","3":"34501.580620","4":"0.0055216346335"},{"1":"Feminino","2":"56","3":"32582.300576","4":"0.0052144729623"},{"1":"Feminino","2":"57","3":"29802.831601","4":"0.0047696466129"},{"1":"Feminino","2":"58","3":"28767.588940","4":"0.0046039663273"},{"1":"Feminino","2":"59","3":"27243.527315","4":"0.0043600554310"},{"1":"Feminino","2":"60","3":"27979.982171","4":"0.0044779177018"},{"1":"Feminino","2":"61","3":"24330.348958","4":"0.0038938302257"},{"1":"Feminino","2":"62","3":"22278.803726","4":"0.0035655008274"},{"1":"Feminino","2":"63","3":"22314.422159","4":"0.0035712012031"},{"1":"Feminino","2":"64","3":"20223.717375","4":"0.0032366047082"},{"1":"Feminino","2":"65","3":"20506.751185","4":"0.0032819014529"},{"1":"Feminino","2":"66","3":"17508.633629","4":"0.0028020825740"},{"1":"Feminino","2":"67","3":"16907.515444","4":"0.0027058795906"},{"1":"Feminino","2":"68","3":"14535.287897","4":"0.0023262281790"},{"1":"Feminino","2":"69","3":"14539.450265","4":"0.0023268943246"},{"1":"Feminino","2":"70","3":"14418.763658","4":"0.0023075796342"},{"1":"Feminino","2":"71","3":"12872.145196","4":"0.0020600587406"},{"1":"Feminino","2":"72","3":"12394.700217","4":"0.0019836484231"},{"1":"Feminino","2":"73","3":"12115.309885","4":"0.0019389347808"},{"1":"Feminino","2":"74","3":"12225.217487","4":"0.0019565243987"},{"1":"Feminino","2":"75","3":"10586.918545","4":"0.0016943309567"},{"1":"Feminino","2":"76","3":"9609.888575","4":"0.0015379670330"},{"1":"Feminino","2":"77","3":"8918.991222","4":"0.0014273957872"},{"1":"Feminino","2":"78","3":"8373.071872","4":"0.0013400268279"},{"1":"Feminino","2":"79","3":"8425.885935","4":"0.0013484791931"},{"1":"Feminino","2":"80","3":"7832.458637","4":"0.0012535070596"},{"1":"Feminino","2":"81","3":"5998.254657","4":"0.0009599609658"},{"1":"Feminino","2":"82","3":"5750.765368","4":"0.0009203527680"},{"1":"Feminino","2":"83","3":"5218.627810","4":"0.0008351894475"},{"1":"Feminino","2":"84","3":"4743.547291","4":"0.0007591575382"},{"1":"Feminino","2":"85","3":"3805.046383","4":"0.0006089598074"},{"1":"Feminino","2":"86","3":"3136.804652","4":"0.0005020143684"},{"1":"Feminino","2":"87","3":"3077.550251","4":"0.0004925312912"},{"1":"Feminino","2":"88","3":"2317.009181","4":"0.0003708142615"},{"1":"Feminino","2":"89","3":"2155.402123","4":"0.0003449506602"},{"1":"Feminino","2":"90","3":"1608.803485","4":"0.0002574729877"},{"1":"Feminino","2":"91","3":"1246.464721","4":"0.0001994842743"},{"1":"Feminino","2":"92","3":"880.400855","4":"0.0001408993955"},{"1":"Feminino","2":"93","3":"726.752656","4":"0.0001163095303"},{"1":"Feminino","2":"94","3":"528.268912","4":"0.0000845441823"},{"1":"Feminino","2":"95","3":"364.333067","4":"0.0000583078817"},{"1":"Feminino","2":"96","3":"471.599527","4":"0.0000754748111"},{"1":"Feminino","2":"97","3":"209.989137","4":"0.0000336066717"},{"1":"Feminino","2":"98","3":"230.186600","4":"0.0000368390746"},{"1":"Feminino","2":"99","3":"118.939635","4":"0.0000190351049"},{"1":"Feminino","2":"100","3":"86.945334","4":"0.0000139147355"},{"1":"Feminino","2":"101","3":"82.525882","4":"0.0000132074462"},{"1":"Feminino","2":"102","3":"57.748046","4":"0.0000092420001"},{"1":"Feminino","2":"103","3":"16.299586","4":"0.0000026085865"},{"1":"Feminino","2":"104","3":"21.717610","4":"0.0000034756874"},{"1":"Feminino","2":"105","3":"3.270345","4":"0.0000005233862"},{"1":"Feminino","2":"106","3":"8.335603","4":"0.0000013340303"},{"1":"Feminino","2":"107","3":"25.230175","4":"0.0000040378384"},{"1":"Feminino","2":"108","3":"5.546970","4":"0.0000008877373"},{"1":"Feminino","2":"109","3":"15.631668","4":"0.0000025016929"},{"1":"Feminino","2":"110","3":"12.317997","4":"0.0000019713728"},{"1":"Masculino","2":"0","3":"42844.612065","4":"0.0068568537900"},{"1":"Masculino","2":"1","3":"40214.232649","4":"0.0064358877409"},{"1":"Masculino","2":"2","3":"40663.254494","4":"0.0065077492187"},{"1":"Masculino","2":"3","3":"41192.347707","4":"0.0065924253221"},{"1":"Masculino","2":"4","3":"42788.484502","4":"0.0068478711321"},{"1":"Masculino","2":"5","3":"44000.128710","4":"0.0070417827299"},{"1":"Masculino","2":"6","3":"44209.859178","4":"0.0070753480041"},{"1":"Masculino","2":"7","3":"42504.024052","4":"0.0068023460679"},{"1":"Masculino","2":"8","3":"43732.777898","4":"0.0069989958930"},{"1":"Masculino","2":"9","3":"48457.553845","4":"0.0077551492643"},{"1":"Masculino","2":"10","3":"52755.987548","4":"0.0084430708024"},{"1":"Masculino","2":"11","3":"52865.182450","4":"0.0084605463598"},{"1":"Masculino","2":"12","3":"51916.623749","4":"0.0083087389793"},{"1":"Masculino","2":"13","3":"52792.920210","4":"0.0084489815074"},{"1":"Masculino","2":"14","3":"54528.236282","4":"0.0087267015756"},{"1":"Masculino","2":"15","3":"58148.429249","4":"0.0093060774334"},{"1":"Masculino","2":"16","3":"53086.237952","4":"0.0084959240930"},{"1":"Masculino","2":"17","3":"54400.416791","4":"0.0087062453381"},{"1":"Masculino","2":"18","3":"54431.965034","4":"0.0087112943204"},{"1":"Masculino","2":"19","3":"56321.033336","4":"0.0090136209029"},{"1":"Masculino","2":"20","3":"56273.818464","4":"0.0090060646325"},{"1":"Masculino","2":"21","3":"58148.128728","4":"0.0093060293380"},{"1":"Masculino","2":"22","3":"58404.587571","4":"0.0093470730236"},{"1":"Masculino","2":"23","3":"56915.693513","4":"0.0091087903465"},{"1":"Masculino","2":"24","3":"57591.391006","4":"0.0092169290060"},{"1":"Masculino","2":"25","3":"58059.498259","4":"0.0092918449134"},{"1":"Masculino","2":"26","3":"54811.248533","4":"0.0087719948700"},{"1":"Masculino","2":"27","3":"58715.535952","4":"0.0093968372176"},{"1":"Masculino","2":"28","3":"58292.442745","4":"0.0093291253602"},{"1":"Masculino","2":"29","3":"56514.092086","4":"0.0090445180347"},{"1":"Masculino","2":"30","3":"56688.907115","4":"0.0090724954404"},{"1":"Masculino","2":"31","3":"51938.321297","4":"0.0083122114560"},{"1":"Masculino","2":"32","3":"50312.855474","4":"0.0080520718269"},{"1":"Masculino","2":"33","3":"49367.080107","4":"0.0079007098914"},{"1":"Masculino","2":"34","3":"47957.102265","4":"0.0076750569692"},{"1":"Masculino","2":"35","3":"47794.964235","4":"0.0076491083911"},{"1":"Masculino","2":"36","3":"46125.675198","4":"0.0073819552927"},{"1":"Masculino","2":"37","3":"47184.734625","4":"0.0075514472147"},{"1":"Masculino","2":"38","3":"47113.833207","4":"0.0075401001484"},{"1":"Masculino","2":"39","3":"46064.819331","4":"0.0073722159168"},{"1":"Masculino","2":"40","3":"48003.720735","4":"0.0076825177914"},{"1":"Masculino","2":"41","3":"45453.868393","4":"0.0072744392991"},{"1":"Masculino","2":"42","3":"46130.667184","4":"0.0073827542104"},{"1":"Masculino","2":"43","3":"44155.506002","4":"0.0070666493192"},{"1":"Masculino","2":"44","3":"46416.176682","4":"0.0074284471643"},{"1":"Masculino","2":"45","3":"46713.598073","4":"0.0074760464981"},{"1":"Masculino","2":"46","3":"45229.202617","4":"0.0072384837775"},{"1":"Masculino","2":"47","3":"43829.080681","4":"0.0070144081950"},{"1":"Masculino","2":"48","3":"40831.469693","4":"0.0065346703873"},{"1":"Masculino","2":"49","3":"39897.940643","4":"0.0063852683529"},{"1":"Masculino","2":"50","3":"40009.765916","4":"0.0064031648750"},{"1":"Masculino","2":"51","3":"36612.108072","4":"0.0058594035491"},{"1":"Masculino","2":"52","3":"35936.001652","4":"0.0057511994449"},{"1":"Masculino","2":"53","3":"33245.937826","4":"0.0053206814999"},{"1":"Masculino","2":"54","3":"31883.259263","4":"0.0051025983567"},{"1":"Masculino","2":"55","3":"32756.316156","4":"0.0052423224241"},{"1":"Masculino","2":"56","3":"30577.958438","4":"0.0048936979494"},{"1":"Masculino","2":"57","3":"28986.955667","4":"0.0046390737889"},{"1":"Masculino","2":"58","3":"26720.635641","4":"0.0042763718222"},{"1":"Masculino","2":"59","3":"26529.920910","4":"0.0042458498274"},{"1":"Masculino","2":"60","3":"25408.633750","4":"0.0040663989760"},{"1":"Masculino","2":"61","3":"22658.324637","4":"0.0036262393723"},{"1":"Masculino","2":"62","3":"21177.378225","4":"0.0033892286368"},{"1":"Masculino","2":"63","3":"19676.343488","4":"0.0031490029648"},{"1":"Masculino","2":"64","3":"17592.290605","4":"0.0028154710405"},{"1":"Masculino","2":"65","3":"16636.326839","4":"0.0026624785531"},{"1":"Masculino","2":"66","3":"16184.538909","4":"0.0025901743909"},{"1":"Masculino","2":"67","3":"15262.297934","4":"0.0024425789006"},{"1":"Masculino","2":"68","3":"12982.413812","4":"0.0020777061353"},{"1":"Masculino","2":"69","3":"12320.560452","4":"0.0019717830915"},{"1":"Masculino","2":"70","3":"12466.011744","4":"0.0019950611233"},{"1":"Masculino","2":"71","3":"11187.921590","4":"0.0017905155131"},{"1":"Masculino","2":"72","3":"9979.824286","4":"0.0015971715621"},{"1":"Masculino","2":"73","3":"9237.743733","4":"0.0014784089545"},{"1":"Masculino","2":"74","3":"8890.941001","4":"0.0014229066284"},{"1":"Masculino","2":"75","3":"8026.156497","4":"0.0012845064745"},{"1":"Masculino","2":"76","3":"6769.032484","4":"0.0010833162866"},{"1":"Masculino","2":"77","3":"6669.830119","4":"0.0010674399353"},{"1":"Masculino","2":"78","3":"6039.273657","4":"0.0009665256486"},{"1":"Masculino","2":"79","3":"5566.347222","4":"0.0008908384790"},{"1":"Masculino","2":"80","3":"4974.703253","4":"0.0007961517496"},{"1":"Masculino","2":"81","3":"4035.577716","4":"0.0006458540531"},{"1":"Masculino","2":"82","3":"3645.164539","4":"0.0005833723094"},{"1":"Masculino","2":"83","3":"2948.794932","4":"0.0004719252837"},{"1":"Masculino","2":"84","3":"2601.656968","4":"0.0004163693072"},{"1":"Masculino","2":"85","3":"2260.332268","4":"0.0003617436856"},{"1":"Masculino","2":"86","3":"2095.590104","4":"0.0003353783417"},{"1":"Masculino","2":"87","3":"1468.613589","4":"0.0002350369899"},{"1":"Masculino","2":"88","3":"1344.315781","4":"0.0002151443627"},{"1":"Masculino","2":"89","3":"1005.646050","4":"0.0001609436425"},{"1":"Masculino","2":"90","3":"910.412432","4":"0.0001457024497"},{"1":"Masculino","2":"91","3":"579.315870","4":"0.0000927137399"},{"1":"Masculino","2":"92","3":"406.709364","4":"0.0000650897863"},{"1":"Masculino","2":"93","3":"347.904733","4":"0.0000556786903"},{"1":"Masculino","2":"94","3":"229.632906","4":"0.0000367504614"},{"1":"Masculino","2":"95","3":"131.339296","4":"0.0000210195473"},{"1":"Masculino","2":"96","3":"115.082437","4":"0.0000184177988"},{"1":"Masculino","2":"97","3":"111.697597","4":"0.0000178760888"},{"1":"Masculino","2":"98","3":"111.443455","4":"0.0000178354159"},{"1":"Masculino","2":"99","3":"97.663109","4":"0.0000156300087"},{"1":"Masculino","2":"100","3":"55.177124","4":"0.0000088305496"},{"1":"Masculino","2":"101","3":"14.953245","4":"0.0000023931181"},{"1":"Masculino","2":"102","3":"23.979059","4":"0.0000038376098"},{"1":"Masculino","2":"103","3":"3.383062","4":"0.0000005414254"},{"1":"Masculino","2":"104","3":"12.209592","4":"0.0000019540237"},{"1":"Masculino","2":"105","3":"9.033254","4":"0.0000014456824"},{"1":"Masculino","2":"106","3":"9.189873","4":"0.0000014707477"},{"1":"Masculino","2":"110","3":"5.572501","4":"0.0000008918233"},{"1":"Masculino","2":"120","3":"2.763061","4":"0.0000004422004"},{"1":"Masculino","2":"122","3":"5.026155","4":"0.0000008043861"},{"1":"Masculino","2":"124","3":"5.158333","4":"0.0000008255399"},{"1":"Masculino","2":"132","3":"10.639422","4":"0.0000017027336"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">proporcao <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade, <span class="dt">y =</span> p, <span class="dt">fill =</span> sexo)) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-3" title="3"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Proporção&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Colplot&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-5" title="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="kw">label_percent</span>())</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/geom-col-1.png" width="672" /></p>
</div>
<div id="visualizando-incerteza" class="section level2">
<h2>Visualizando incerteza</h2>
<p>Existem gráficos no ggplot2 que nos ajudam a visualizar incerteza, mostrando uma margem de erro, ou intervalo de confiança. Podemos calcular, por exemplo, a idade média da população brasileira, por estado, pesquisada pela PNAD Contínua, em 2018.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">library</span>(survey)</a>
<a class="sourceLine" id="cb33-2" title="2"></a>
<a class="sourceLine" id="cb33-3" title="3">pnadc &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;pnadC-Subarq-1.rds&quot;</span>)</a>
<a class="sourceLine" id="cb33-4" title="4"></a>
<a class="sourceLine" id="cb33-5" title="5"><span class="co"># Calcule a idade média ponderada</span></a>
<a class="sourceLine" id="cb33-6" title="6">idade_media &lt;-<span class="st"> </span><span class="kw">svyby</span>(</a>
<a class="sourceLine" id="cb33-7" title="7">  <span class="op">~</span><span class="st"> </span>V2009,</a>
<a class="sourceLine" id="cb33-8" title="8">  <span class="dt">by =</span> <span class="op">~</span><span class="st"> </span>UF,</a>
<a class="sourceLine" id="cb33-9" title="9">  <span class="dt">design =</span> pnadc,</a>
<a class="sourceLine" id="cb33-10" title="10">  <span class="dt">FUN =</span> svymean,</a>
<a class="sourceLine" id="cb33-11" title="11">  <span class="dt">na.rm.all =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb33-12" title="12">)</a>
<a class="sourceLine" id="cb33-13" title="13"><span class="co"># Calcule os intervalos de confiança</span></a>
<a class="sourceLine" id="cb33-14" title="14">idade_media &lt;-<span class="st"> </span><span class="kw">confint</span>(idade_media) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;UF&quot;</span>)</a>
<a class="sourceLine" id="cb33-15" title="15">idade_media</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["UF"],"name":[1],"type":["chr"],"align":["left"]},{"label":["2.5 %"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["97.5 %"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Rondônia","2":"32.16782","3":"33.61036"},{"1":"Acre","2":"29.87038","3":"31.38553"},{"1":"Amazonas","2":"29.77578","3":"31.10192"},{"1":"Roraima","2":"29.44591","3":"30.90269"},{"1":"Pará","2":"30.50326","3":"31.59624"},{"1":"Amapá","2":"28.53061","3":"30.90480"},{"1":"Tocantins","2":"32.74757","3":"34.65994"},{"1":"Maranhão","2":"31.06071","3":"31.85970"},{"1":"Piauí","2":"33.43649","3":"34.96285"},{"1":"Ceará","2":"33.96186","3":"34.98069"},{"1":"Rio Grande do Norte","2":"33.79581","3":"35.41832"},{"1":"Paraíba","2":"33.78175","3":"35.42623"},{"1":"Pernambuco","2":"33.70483","3":"34.84867"},{"1":"Alagoas","2":"33.14864","3":"34.12597"},{"1":"Sergipe","2":"32.55749","3":"33.98523"},{"1":"Bahia","2":"33.83166","3":"34.91183"},{"1":"Minas Gerais","2":"35.83631","3":"36.71948"},{"1":"Espírito Santo","2":"34.53302","3":"35.86373"},{"1":"Rio de Janeiro","2":"37.95738","3":"38.85573"},{"1":"São Paulo","2":"36.02995","3":"37.05582"},{"1":"Paraná","2":"35.57928","3":"36.59135"},{"1":"Santa Catarina","2":"35.94836","3":"36.77916"},{"1":"Rio Grande do Sul","2":"37.15823","3":"38.47765"},{"1":"Mato Grosso do Sul","2":"33.31574","3":"34.83987"},{"1":"Mato Grosso","2":"33.40586","3":"34.64524"},{"1":"Goiás","2":"33.71560","3":"34.96393"},{"1":"Distrito Federal","2":"33.59493","3":"35.12899"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="co"># Hora do gráfico</span></a>
<a class="sourceLine" id="cb34-2" title="2">idade_media <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb34-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">xmin =</span> <span class="st">`</span><span class="dt">2.5 %</span><span class="st">`</span>, <span class="dt">xmax =</span> <span class="st">`</span><span class="dt">97.5 %</span><span class="st">`</span>, <span class="dt">y =</span> UF)) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-4" title="4"><span class="st">  </span><span class="kw">geom_errorbarh</span>()</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/errorbarh-1.png" width="672" /></p>
</div>
<div id="mapas" class="section level2">
<h2>Mapas</h2>
<p>Mapas exigem que a gente entre numa seara complexa. A forma como os objetos no espaço são representados não é algo trivial de se introduzir em tão pouco tempo. Em linhas muito gerais, o R guarda informações sobre as formas geométricas dos objetos na forma pontos, linhas, polígonos e coleções destas formas. O pacote principal para trabalhar com dados espaciais é o <code>sf</code> (<a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">Pebesma et al. 2020</a>). O IBGE tem uma API só para você baixar as malhas espaciais deles, e graças ao <a href="https://cran.r-project.org/web/packages/geobr/vignettes/intro_to_geobr.html">Rafael Pereira e colaboradores</a>, a gente pode importar essas malhas com um mínimo de esforço, usando o pacote <code>geobr</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">library</span>(sf)</a></code></pre></div>
<pre><code>## Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">library</span>(geobr)</a>
<a class="sourceLine" id="cb37-2" title="2"></a>
<a class="sourceLine" id="cb37-3" title="3"><span class="co"># Importe o arquivo com as informações dos estados</span></a>
<a class="sourceLine" id="cb37-4" title="4">uf_mapa &lt;-<span class="st"> </span><span class="kw">read_state</span>()</a></code></pre></div>
<pre><code>## Using year 2010</code></pre>
<pre><code>## Loading data for the whole country</code></pre>
<pre><code>## 
  |                                          
  |                                    |   0%
  |                                          
  |=                                   |   4%
  |                                          
  |===                                 |   7%
  |                                          
  |====                                |  11%
  |                                          
  |=====                               |  15%
  |                                          
  |=======                             |  19%
  |                                          
  |========                            |  22%
  |                                          
  |=========                           |  26%
  |                                          
  |===========                         |  30%
  |                                          
  |============                        |  33%
  |                                          
  |=============                       |  37%
  |                                          
  |===============                     |  41%
  |                                          
  |================                    |  44%
  |                                          
  |=================                   |  48%
  |                                          
  |===================                 |  52%
  |                                          
  |====================                |  56%
  |                                          
  |=====================               |  59%
  |                                          
  |=======================             |  63%
  |                                          
  |========================            |  67%
  |                                          
  |=========================           |  70%
  |                                          
  |===========================         |  74%
  |                                          
  |============================        |  78%
  |                                          
  |=============================       |  81%
  |                                          
  |===============================     |  85%
  |                                          
  |================================    |  89%
  |                                          
  |=================================   |  93%
  |                                          
  |=================================== |  96%
  |                                          
  |====================================| 100%</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">uf_mapa</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["code_state"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["abbrev_state"],"name":[2],"type":["chr"],"align":["left"]},{"label":["name_state"],"name":[3],"type":["chr"],"align":["left"]},{"label":["code_region"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["name_region"],"name":[5],"type":["chr"],"align":["left"]},{"label":["geom"],"name":[6],"type":["S3: sfc_MULTIPOLYGON"],"align":["right"]}],"data":[{"1":"11","2":"RO","3":"Rondônia","4":"1","5":"Norte","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"1"},{"1":"12","2":"AC","3":"Acre","4":"1","5":"Norte","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"2"},{"1":"13","2":"AM","3":"Amazonas","4":"1","5":"Norte","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"3"},{"1":"14","2":"RR","3":"Roraima","4":"1","5":"Norte","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"4"},{"1":"15","2":"PA","3":"Pará","4":"1","5":"Norte","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"5"},{"1":"16","2":"AP","3":"Amapá","4":"1","5":"Norte","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"6"},{"1":"17","2":"TO","3":"Tocantins","4":"1","5":"Norte","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"7"},{"1":"21","2":"MA","3":"Maranhão","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"8"},{"1":"22","2":"PI","3":"Piauí","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"9"},{"1":"23","2":"CE","3":"Ceará","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"10"},{"1":"24","2":"RN","3":"Rio Grande Do Norte","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"11"},{"1":"25","2":"PB","3":"Paraíba","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"12"},{"1":"26","2":"PE","3":"Pernambuco","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"13"},{"1":"27","2":"AL","3":"Alagoas","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"14"},{"1":"28","2":"SE","3":"Sergipe","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"15"},{"1":"29","2":"BA","3":"Bahia","4":"2","5":"Nordeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"16"},{"1":"31","2":"MG","3":"Minas Gerais","4":"3","5":"Sudeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"17"},{"1":"32","2":"ES","3":"Espirito Santo","4":"3","5":"Sudeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"18"},{"1":"33","2":"RJ","3":"Rio De Janeiro","4":"3","5":"Sudeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"19"},{"1":"35","2":"SP","3":"São Paulo","4":"3","5":"Sudeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"20"},{"1":"41","2":"PR","3":"Paraná","4":"4","5":"Sul","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"21"},{"1":"42","2":"SC","3":"Santa Catarina","4":"4","5":"Sul","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"22"},{"1":"43","2":"RS","3":"Rio Grande Do Sul","4":"4","5":"Sul","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"23"},{"1":"50","2":"MS","3":"Mato Grosso Do Sul","4":"5","5":"Centro Oeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"24"},{"1":"51","2":"MT","3":"Mato Grosso","4":"5","5":"Centro Oeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"25"},{"1":"52","2":"GO","3":"Goiás","4":"5","5":"Centro Oeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"26"},{"1":"53","2":"DF","3":"Distrito Federal","4":"5","5":"Centro Oeste","6":"<S3: sfc_MULTIPOLYGON>","_rn_":"27"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="co"># Mapa básico</span></a>
<a class="sourceLine" id="cb42-2" title="2">uf_mapa <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb42-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb42-4" title="4"><span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb42-5" title="5"><span class="st">  </span><span class="kw">geom_sf_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> name_state))</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/mapa-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="co"># Quando queremos associar outras informações ao mapa, precisamos recorrer a joins</span></a>
<a class="sourceLine" id="cb43-2" title="2">renda &lt;-<span class="st"> </span><span class="kw">svyby</span>(<span class="op">~</span>VD5011, <span class="dt">by =</span> <span class="op">~</span>UF, <span class="dt">design =</span> pnadc, <span class="dt">FUN =</span> svymean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb43-3" title="3">renda</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["UF"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["VD5011"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Rondônia","2":"1112.7490","3":"52.60413","_rn_":"Rondônia"},{"1":"Acre","2":"906.5551","3":"39.67216","_rn_":"Acre"},{"1":"Amazonas","2":"807.7911","3":"47.73441","_rn_":"Amazonas"},{"1":"Roraima","2":"1202.6107","3":"106.39626","_rn_":"Roraima"},{"1":"Pará","2":"858.1506","3":"38.10223","_rn_":"Pará"},{"1":"Amapá","2":"849.5659","3":"53.95813","_rn_":"Amapá"},{"1":"Tocantins","2":"1036.4686","3":"58.39280","_rn_":"Tocantins"},{"1":"Maranhão","2":"613.8516","3":"17.80521","_rn_":"Maranhão"},{"1":"Piauí","2":"815.2065","3":"35.74304","_rn_":"Piauí"},{"1":"Ceará","2":"860.5354","3":"39.22047","_rn_":"Ceará"},{"1":"Rio Grande do Norte","2":"955.2063","3":"56.23425","_rn_":"Rio Grande do Norte"},{"1":"Paraíba","2":"890.8375","3":"52.69805","_rn_":"Paraíba"},{"1":"Pernambuco","2":"873.4553","3":"35.57119","_rn_":"Pernambuco"},{"1":"Alagoas","2":"713.5903","3":"34.61716","_rn_":"Alagoas"},{"1":"Sergipe","2":"910.3445","3":"63.17103","_rn_":"Sergipe"},{"1":"Bahia","2":"850.4868","3":"32.06675","_rn_":"Bahia"},{"1":"Minas Gerais","2":"1307.1201","3":"33.50185","_rn_":"Minas Gerais"},{"1":"Espírito Santo","2":"1324.6501","3":"52.76759","_rn_":"Espírito Santo"},{"1":"Rio de Janeiro","2":"1699.6344","3":"48.17853","_rn_":"Rio de Janeiro"},{"1":"São Paulo","2":"1893.1645","3":"74.08054","_rn_":"São Paulo"},{"1":"Paraná","2":"1597.9090","3":"46.66756","_rn_":"Paraná"},{"1":"Santa Catarina","2":"1630.3846","3":"29.66374","_rn_":"Santa Catarina"},{"1":"Rio Grande do Sul","2":"1694.6060","3":"46.06169","_rn_":"Rio Grande do Sul"},{"1":"Mato Grosso do Sul","2":"1431.5999","3":"63.32588","_rn_":"Mato Grosso do Sul"},{"1":"Mato Grosso","2":"1365.0730","3":"47.08931","_rn_":"Mato Grosso"},{"1":"Goiás","2":"1307.5075","3":"43.72715","_rn_":"Goiás"},{"1":"Distrito Federal","2":"2477.2318","3":"146.75529","_rn_":"Distrito Federal"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="co">#Join do mapa com a informação sobre renda média das ufs</span></a>
<a class="sourceLine" id="cb44-2" title="2">join &lt;-<span class="st"> </span><span class="kw">left_join</span>(uf_mapa, renda, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;name_state&quot;</span> =<span class="st"> &quot;UF&quot;</span>))</a>
<a class="sourceLine" id="cb44-3" title="3">join</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["code_state"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["abbrev_state"],"name":[2],"type":["chr"],"align":["left"]},{"label":["name_state"],"name":[3],"type":["chr"],"align":["left"]},{"label":["code_region"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["name_region"],"name":[5],"type":["chr"],"align":["left"]},{"label":["VD5011"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["geom"],"name":[8],"type":["S3: sfc_MULTIPOLYGON"],"align":["right"]}],"data":[{"1":"11","2":"RO","3":"Rondônia","4":"1","5":"Norte","6":"1112.7490","7":"52.60413","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"12","2":"AC","3":"Acre","4":"1","5":"Norte","6":"906.5551","7":"39.67216","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"13","2":"AM","3":"Amazonas","4":"1","5":"Norte","6":"807.7911","7":"47.73441","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"14","2":"RR","3":"Roraima","4":"1","5":"Norte","6":"1202.6107","7":"106.39626","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"15","2":"PA","3":"Pará","4":"1","5":"Norte","6":"858.1506","7":"38.10223","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"16","2":"AP","3":"Amapá","4":"1","5":"Norte","6":"849.5659","7":"53.95813","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"17","2":"TO","3":"Tocantins","4":"1","5":"Norte","6":"1036.4686","7":"58.39280","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"21","2":"MA","3":"Maranhão","4":"2","5":"Nordeste","6":"613.8516","7":"17.80521","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"22","2":"PI","3":"Piauí","4":"2","5":"Nordeste","6":"815.2065","7":"35.74304","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"23","2":"CE","3":"Ceará","4":"2","5":"Nordeste","6":"860.5354","7":"39.22047","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"24","2":"RN","3":"Rio Grande Do Norte","4":"2","5":"Nordeste","6":"NA","7":"NA","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"25","2":"PB","3":"Paraíba","4":"2","5":"Nordeste","6":"890.8375","7":"52.69805","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"26","2":"PE","3":"Pernambuco","4":"2","5":"Nordeste","6":"873.4553","7":"35.57119","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"27","2":"AL","3":"Alagoas","4":"2","5":"Nordeste","6":"713.5903","7":"34.61716","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"28","2":"SE","3":"Sergipe","4":"2","5":"Nordeste","6":"910.3445","7":"63.17103","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"29","2":"BA","3":"Bahia","4":"2","5":"Nordeste","6":"850.4868","7":"32.06675","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"31","2":"MG","3":"Minas Gerais","4":"3","5":"Sudeste","6":"1307.1201","7":"33.50185","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"32","2":"ES","3":"Espirito Santo","4":"3","5":"Sudeste","6":"NA","7":"NA","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"33","2":"RJ","3":"Rio De Janeiro","4":"3","5":"Sudeste","6":"NA","7":"NA","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"35","2":"SP","3":"São Paulo","4":"3","5":"Sudeste","6":"1893.1645","7":"74.08054","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"41","2":"PR","3":"Paraná","4":"4","5":"Sul","6":"1597.9090","7":"46.66756","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"42","2":"SC","3":"Santa Catarina","4":"4","5":"Sul","6":"1630.3846","7":"29.66374","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"43","2":"RS","3":"Rio Grande Do Sul","4":"4","5":"Sul","6":"NA","7":"NA","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"50","2":"MS","3":"Mato Grosso Do Sul","4":"5","5":"Centro Oeste","6":"NA","7":"NA","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"51","2":"MT","3":"Mato Grosso","4":"5","5":"Centro Oeste","6":"1365.0730","7":"47.08931","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"52","2":"GO","3":"Goiás","4":"5","5":"Centro Oeste","6":"1307.5075","7":"43.72715","8":"<S3: sfc_MULTIPOLYGON>"},{"1":"53","2":"DF","3":"Distrito Federal","4":"5","5":"Centro Oeste","6":"2477.2318","7":"146.75529","8":"<S3: sfc_MULTIPOLYGON>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="co"># Mapa coroplético de renda</span></a>
<a class="sourceLine" id="cb45-2" title="2">join <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb45-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb45-4" title="4"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> VD5011))</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/mapa-2.png" width="672" /></p>
</div>
</div>
<div id="modelos" class="section level1">
<h1>Modelos</h1>
<p>Modelos estatísticos são uma forma de medir os efeitos de determinadas variáveis, as vezes chamadas de covariáveis, variáveis independentes, etc. - em uma variável resposta, ou variável dependente, que é a nossa variável de interesse. Também podem ser usados para explorar os dados e descobrir padrões, ou como uma ajuda na visualização de bancos de dados complexos e pouco estruturados.</p>
<div id="introdução-1" class="section level2">
<h2>Introdução</h2>
<p>Modelagem é um assunto complexo e sobre o qual existe uma vasta literatura. Meu objetivo aqui é que vocês entendam o que é um modelo e como ele é construído, pois os modelos demográficos apresentados nas disciplinas de Análise Demográfica seguem as mesmas regras.</p>
<ol style="list-style-type: decimal">
<li><p>Primeiro, você define uma família de modelos que poderiam se ajustar aos seus dados. Aqui, vamos usar uma família de modelos lineares simples. Até porque eu não entendo muito dessas coisas.</p></li>
<li><p>Depois, você tenta ajustar um modelo específico, que, a partir de alguns testes, você consegue determinar que é o mais adequado aos seus dados.</p></li>
</ol>
<p>Os modelos são, por definição, <strong>incorretos e falsos</strong>, pois eles são apenas a melhor aproximação possível de um fenômeno real complexo. Nem por isso eles deixam de ser <strong>úteis</strong>, o importante é que tanto você quanto o seu público entendam o <strong>potencial</strong> e os <strong>limites</strong> do modelo.</p>
<blockquote>
<p>All models are wrong, but some are useful.<br />
George Box</p>
</blockquote>
</div>
<div id="um-exemplo-simples-de-modelo-linear" class="section level2">
<h2>Um exemplo simples de modelo linear</h2>
<p>Para entender como os modelos funcionam, podemos voltar para aquela nossa nuvem de pontos que relacionava a idade média com a renda per capita.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">g &lt;-<span class="st"> </span>medias_sexo <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> idade_media, <span class="dt">y =</span> renda_pc_med)) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb46-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Idade&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Renda Per Capita&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Scatterplot&quot;</span>)</a>
<a class="sourceLine" id="cb46-5" title="5">g</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/model1-1.png" width="672" /></p>
<p>Não está muito claro pra nós, mas a gente poderia esticar nossa imaginação e dizer que existe uma relação <strong>linear</strong> entre idade e renda per capita. Mas como essa relação linear seria definida? Em outras palavras, se eu sei que existe um modelo linear pra essa relação, que modelo é esse e como eu poderia encontrá-lo?</p>
<p>Uma primeira tentativa, seria a gente chutar. Com computadores é fácil chutar muitas possibilidades.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">modelos &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb47-2" title="2">  <span class="dt">a1 =</span> <span class="kw">runif</span>(<span class="dv">500</span>, <span class="dv">300</span>, <span class="dv">1800</span>),</a>
<a class="sourceLine" id="cb47-3" title="3">  <span class="dt">a2 =</span> <span class="kw">runif</span>(<span class="dv">500</span>, <span class="dv">-50</span>, <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb47-4" title="4">)</a>
<a class="sourceLine" id="cb47-5" title="5"></a>
<a class="sourceLine" id="cb47-6" title="6">g <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2), <span class="dt">data =</span> modelos, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/model2-1.png" width="672" /></p>
<p>Se nos colocássemos o exercício de determinar qual dessas linhas melhor representa a relação entre renda per capita e idade, provavelmente chegaríamos a conclusão de que a maioria desses modelos é muito ruim! Mas que estratégia poderíamos adotar para escolher um modelo melhor?</p>
<p><img src="model-dist.png" /><!-- --></p>
<p>Uma estratégia eficiente é você encontrar uma linha que tinha as menores distâncias possíveis em relação aos pontos. Essa distância é a diferença entre o valor dado pelo modelo (<strong>valor predito</strong>) e o valor real do dado (<strong>valor resposta</strong>). Pra fazer a conta dessa distância, podemos definir uma nova função que faz essa conta. Novamente, estamos <strong>calculando a distância entre o valor predito pelo modelo e o valor real do dado</strong>!</p>
<p>A função vai receber dois parâmetros, um são os nossos <strong>coeficientes</strong> do modelo, que descrevem a curva matemática no formato <span class="math inline">\(a_1x + a_2\)</span>. O outro é o nosso dado.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="co"># Definição da função</span></a>
<a class="sourceLine" id="cb48-2" title="2">model1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {</a>
<a class="sourceLine" id="cb48-3" title="3">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>renda_pc_med <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb48-4" title="4">}</a>
<a class="sourceLine" id="cb48-5" title="5"></a>
<a class="sourceLine" id="cb48-6" title="6"><span class="co"># Cálculo das distâncias</span></a>
<a class="sourceLine" id="cb48-7" title="7"><span class="kw">model1</span>(<span class="kw">c</span>(<span class="dv">200</span>, <span class="fl">-0.5</span>), medias_sexo)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>##  [1]  -30.44283  -33.90398  -84.81528  -77.75916 -169.97732 -166.28709
##  [7] -235.55503 -230.80685 -157.21888 -151.17431</code></pre>
<p>Ok, mas ainda não resolvemos nosso problema! Essa função calcula um número de distâncias igual ao número de pontos. Algumas distâncias podem ser menores em dado modelo, mas muito maiores em outro. Precisamos de uma medida global que nos diga a distância. A solução adotada pelos estatísticos é o <strong>root-mean-squared-error</strong>. Ou seja, você calcula a diferença entre o <strong>valor real</strong> e o <strong>valor predito</strong>, eleva ela ao quadrado, tira sua média e depois tira sua raíz quadrada. Essa sequência repetitiva de operações é perfeita para um função!</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">measure_distance &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb50-2" title="2">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>renda_pc_med <span class="op">-</span><span class="st"> </span><span class="kw">model1</span>(mod, data) <span class="co"># Calcula as diferenças!</span></a>
<a class="sourceLine" id="cb50-3" title="3">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)) <span class="co"># eleva ao quadrado, tira a média, tira a raíz</span></a>
<a class="sourceLine" id="cb50-4" title="4">}</a>
<a class="sourceLine" id="cb50-5" title="5"></a>
<a class="sourceLine" id="cb50-6" title="6"><span class="co"># Vocês podem brincar com os parâmetros do modelo e ver se a distância aumenta ou diminui</span></a>
<a class="sourceLine" id="cb50-7" title="7"><span class="kw">measure_distance</span>(<span class="kw">c</span>(<span class="dv">200</span>, <span class="fl">-0.5</span>), medias_sexo)</a></code></pre></div>
<pre><code>## [1] 941.7741</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">measure_distance</span>(<span class="kw">c</span>(<span class="dv">250</span>, <span class="fl">0.5</span>), medias_sexo)</a></code></pre></div>
<pre><code>## [1] 148.1704</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="kw">measure_distance</span>(<span class="kw">c</span>(<span class="dv">250</span>, <span class="dv">1</span>), medias_sexo)</a></code></pre></div>
<pre><code>## [1] 250</code></pre>
<p>Ok, agora que temos essas ferramentas na mão, podemos calcular as distâncias <strong>root mean squared error</strong> pra todos os modelos que inventamos.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="co"># Mais uma função! Essa calcula a distância entre os parâmetros do modelo e o valor real</span></a>
<a class="sourceLine" id="cb56-2" title="2">renda_dist &lt;-<span class="st"> </span><span class="cf">function</span>(a1, a2) {</a>
<a class="sourceLine" id="cb56-3" title="3">  <span class="kw">measure_distance</span>(<span class="kw">c</span>(a1, a2), medias_sexo)</a>
<a class="sourceLine" id="cb56-4" title="4">}</a>
<a class="sourceLine" id="cb56-5" title="5"></a>
<a class="sourceLine" id="cb56-6" title="6">modelos &lt;-<span class="st"> </span>modelos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb56-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dist =</span> <span class="kw">map2_dbl</span>(<span class="dt">.x =</span> a1, <span class="dt">.y =</span>  a2, <span class="op">~</span><span class="st"> </span><span class="kw">renda_dist</span>(.x, .y)))</a>
<a class="sourceLine" id="cb56-8" title="8">modelos</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["a1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["a2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["dist"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"932.0458","2":"-1.02562050","3":"666.0059"},{"1":"1167.8814","2":"-29.75041303","3":"22130.1658"},{"1":"1777.4383","2":"-27.24900977","3":"19648.9315"},{"1":"1639.8027","2":"-33.01492939","3":"24142.9787"},{"1":"1619.2076","2":"-11.11611812","3":"7603.5312"},{"1":"1532.2148","2":"-7.53973089","3":"4986.1316"},{"1":"644.9196","2":"28.27183064","3":"21257.4620"},{"1":"1086.1324","2":"-35.04402949","3":"26213.6045"},{"1":"1720.6711","2":"18.19564365","3":"14684.6119"},{"1":"704.4490","2":"-6.45990528","3":"4962.2546"},{"1":"1163.6069","2":"-41.57024268","3":"31075.3356"},{"1":"602.8896","2":"24.40034642","3":"18287.9405"},{"1":"1705.5594","2":"20.64516870","3":"16522.2383"},{"1":"656.6042","2":"22.29862504","3":"16750.3358"},{"1":"1724.5290","2":"-17.51253554","3":"12337.0965"},{"1":"433.1222","2":"7.08185297","3":"5022.4176"},{"1":"1718.4882","2":"-41.94409407","3":"30820.9284"},{"1":"441.8766","2":"-23.98970204","3":"18475.6616"},{"1":"1358.2658","2":"-11.15125902","3":"7880.2758"},{"1":"846.6759","2":"24.14501782","3":"18332.0259"},{"1":"1676.9607","2":"-20.94095631","3":"14975.3025"},{"1":"536.0282","2":"10.38888444","3":"7624.0598"},{"1":"1755.5748","2":"33.93732095","3":"26624.3958"},{"1":"984.1109","2":"2.26441654","3":"1926.4455"},{"1":"1174.9384","2":"-23.24280851","3":"17200.9358"},{"1":"1328.0962","2":"16.95071389","3":"13359.7005"},{"1":"985.8581","2":"32.09307180","3":"24479.7650"},{"1":"685.8406","2":"-2.95104780","3":"2328.8518"},{"1":"1602.2010","2":"14.90133025","3":"12077.8034"},{"1":"737.4078","2":"-49.98188517","3":"37851.5752"},{"1":"1679.6301","2":"4.49514335","3":"4293.6384"},{"1":"786.2905","2":"-14.43531262","3":"10914.8373"},{"1":"1451.3648","2":"-11.51896049","3":"8068.8234"},{"1":"1088.0841","2":"-17.28262631","3":"12776.8209"},{"1":"1315.1514","2":"-16.19443728","3":"11734.7383"},{"1":"856.7919","2":"-27.37969602","3":"20638.0321"},{"1":"831.7643","2":"39.79864086","3":"30158.8348"},{"1":"748.4311","2":"9.52366053","3":"7176.9052"},{"1":"971.2104","2":"25.36964195","3":"19379.6193"},{"1":"985.4741","2":"4.38577500","3":"3525.9783"},{"1":"484.3251","2":"-37.10020864","3":"28352.3011"},{"1":"1147.0734","2":"-9.13683246","3":"6560.4680"},{"1":"893.9165","2":"8.01713991","3":"6179.9631"},{"1":"754.1821","2":"-49.63330911","3":"37571.6186"},{"1":"1158.4797","2":"-17.30435556","3":"12725.2811"},{"1":"1279.2248","2":"-20.47019545","3":"15003.0704"},{"1":"1252.6346","2":"-18.09156789","3":"13229.7608"},{"1":"848.1754","2":"-44.31778060","3":"33459.4214"},{"1":"1769.8081","2":"-45.67200206","3":"33591.1403"},{"1":"1520.2831","2":"-25.65206958","3":"18689.4681"},{"1":"1584.6341","2":"49.02526189","3":"37870.8336"},{"1":"983.3808","2":"-38.17711484","3":"28683.1753"},{"1":"465.2065","2":"27.97651233","3":"20859.3150"},{"1":"1784.4516","2":"29.30890215","3":"23151.7218"},{"1":"949.6218","2":"23.30289434","3":"17795.2508"},{"1":"1258.1405","2":"-25.90988765","3":"19137.8361"},{"1":"639.1035","2":"-14.63884318","3":"11211.1255"},{"1":"1616.3566","2":"-26.70873657","3":"19395.8635"},{"1":"947.6962","2":"-43.68626461","3":"32885.2327"},{"1":"905.2746","2":"-29.50850816","3":"22201.4170"},{"1":"1543.7118","2":"46.24703517","3":"35729.4242"},{"1":"1506.1467","2":"9.84240691","3":"8159.4225"},{"1":"1723.4497","2":"-49.61573160","3":"36619.1773"},{"1":"1462.8685","2":"3.19274904","3":"3098.9303"},{"1":"715.6689","2":"-0.39595820","3":"399.8301"},{"1":"1327.8790","2":"32.58880863","3":"25187.7123"},{"1":"1362.9321","2":"27.28430699","3":"21209.4667"},{"1":"816.0033","2":"-8.87488299","3":"6680.8369"},{"1":"1580.0424","2":"21.38341556","3":"16958.0226"},{"1":"686.1131","2":"12.44005852","3":"9321.8262"},{"1":"1269.9262","2":"7.66214733","3":"6280.1369"},{"1":"880.5117","2":"-5.70465068","3":"4222.3823"},{"1":"706.4518","2":"-43.41740746","3":"32915.7155"},{"1":"1602.6156","2":"-24.11261711","3":"17445.6352"},{"1":"323.8107","2":"8.63043261","3":"6087.1913"},{"1":"1447.6459","2":"-2.44657011","3":"1250.8468"},{"1":"930.6771","2":"24.01476367","3":"18315.2802"},{"1":"456.4933","2":"48.46490677","3":"36349.9104"},{"1":"1667.4302","2":"18.53646007","3":"14890.3167"},{"1":"389.8414","2":"-30.52731273","3":"23471.6762"},{"1":"918.3416","2":"-38.80853152","3":"29223.8390"},{"1":"563.1664","2":"27.09794869","3":"20289.9514"},{"1":"342.2687","2":"-39.39895874","3":"30229.0667"},{"1":"877.4204","2":"-29.87657252","3":"22506.8179"},{"1":"536.6324","2":"46.73066649","3":"35115.8575"},{"1":"1468.4945","2":"15.83097645","3":"12650.0476"},{"1":"1532.2528","2":"37.36185161","3":"28997.1896"},{"1":"654.0024","2":"8.47084881","3":"6288.5012"},{"1":"690.6766","2":"24.28533325","3":"18286.3432"},{"1":"1200.9275","2":"18.77310572","3":"14613.8928"},{"1":"1320.1690","2":"32.91510013","3":"25427.0199"},{"1":"1306.4522","2":"-21.22749265","3":"15549.5408"},{"1":"1326.5354","2":"8.23646076","3":"6769.6476"},{"1":"982.5318","2":"18.77592730","3":"14403.0835"},{"1":"399.6497","2":"9.34700533","3":"6703.0884"},{"1":"1694.3112","2":"5.88817215","3":"5358.1981"},{"1":"423.1092","2":"49.46510298","3":"37074.1073"},{"1":"1095.6245","2":"-13.27658477","3":"9739.8631"},{"1":"485.3262","2":"28.72902066","3":"21448.1283"},{"1":"1717.2049","2":"22.52673081","3":"17956.5804"},{"1":"827.2297","2":"34.63621309","3":"26249.2166"},{"1":"1240.4622","2":"2.22316151","3":"2150.2760"},{"1":"1493.6684","2":"39.28139140","3":"30411.6161"},{"1":"1395.8019","2":"13.53170853","3":"10840.3735"},{"1":"1421.5594","2":"-41.15379993","3":"30510.5133"},{"1":"812.9260","2":"-6.60768931","3":"4969.6806"},{"1":"1468.7398","2":"-7.74032355","3":"5197.8964"},{"1":"1698.4694","2":"-10.87826991","3":"7348.0225"},{"1":"857.2833","2":"-2.92334922","3":"2145.4987"},{"1":"965.5566","2":"35.46822860","3":"27013.1654"},{"1":"1051.6209","2":"10.28861119","3":"8051.6419"},{"1":"1655.4881","2":"29.48767890","3":"23161.2050"},{"1":"808.0726","2":"-0.20745294","3":"232.5797"},{"1":"1212.8847","2":"4.15247073","3":"3574.1926"},{"1":"410.2356","2":"17.92801255","3":"13204.4616"},{"1":"583.1525","2":"-28.65023764","3":"21864.2745"},{"1":"1090.1405","2":"8.85552263","3":"7005.8551"},{"1":"706.3043","2":"37.60606737","3":"28378.2234"},{"1":"1331.0255","2":"47.10579000","3":"36172.0600"},{"1":"1618.3985","2":"-33.97353289","3":"24888.7536"},{"1":"1301.8742","2":"29.18318333","3":"22586.3008"},{"1":"961.2418","2":"33.13529389","3":"25244.2033"},{"1":"400.0604","2":"23.01703226","3":"17044.2596"},{"1":"722.9877","2":"-19.23429728","3":"14606.0636"},{"1":"1035.1970","2":"22.01807629","3":"16906.7513"},{"1":"978.3733","2":"34.14459503","3":"26024.3633"},{"1":"1263.3114","2":"-24.31699496","3":"17927.9955"},{"1":"1466.5601","2":"-25.52948496","3":"18648.6537"},{"1":"1321.2886","2":"38.53694140","3":"29680.6732"},{"1":"939.7233","2":"26.76896164","3":"20407.4602"},{"1":"1213.9549","2":"-25.61142105","3":"18954.8064"},{"1":"1743.2887","2":"15.30943853","3":"12524.3747"},{"1":"653.5084","2":"-24.56210840","3":"18703.5631"},{"1":"741.0501","2":"46.08430751","3":"34825.5771"},{"1":"1323.0591","2":"-27.40690866","3":"20207.3963"},{"1":"491.9261","2":"42.90435985","3":"32177.8855"},{"1":"1223.4794","2":"15.63007720","3":"12258.8025"},{"1":"727.2315","2":"-16.94236514","3":"12868.2807"},{"1":"864.9644","2":"8.62456339","3":"6610.8984"},{"1":"1426.7429","2":"6.86771455","3":"5834.0571"},{"1":"1055.9609","2":"9.74740938","3":"7646.6871"},{"1":"927.3992","2":"40.37364277","3":"30686.8113"},{"1":"424.4481","2":"-19.49786162","3":"15094.6064"},{"1":"614.2959","2":"-40.78261347","3":"31011.9160"},{"1":"669.5452","2":"35.75703320","3":"26943.7390"},{"1":"431.8926","2":"-31.85309630","3":"24433.8201"},{"1":"1097.9824","2":"19.38515236","3":"14976.4287"},{"1":"1683.8697","2":"-44.57480558","3":"32844.3632"},{"1":"885.4487","2":"14.19804101","3":"10845.8711"},{"1":"1759.4791","2":"-15.72708683","3":"10953.6909"},{"1":"1124.8331","2":"-8.23022372","3":"5896.6263"},{"1":"1431.9731","2":"15.62990954","3":"12462.3153"},{"1":"1020.4892","2":"-5.35552460","3":"3824.9216"},{"1":"1311.9141","2":"16.77427648","3":"13210.4673"},{"1":"408.4254","2":"24.11781522","3":"17885.1064"},{"1":"966.7641","2":"33.78469134","3":"25740.8165"},{"1":"345.6041","2":"25.61148372","3":"18953.9676"},{"1":"631.2959","2":"28.56282713","3":"21464.3413"},{"1":"1770.2138","2":"-47.34816472","3":"34858.6442"},{"1":"1672.4160","2":"31.97606716","3":"25059.8785"},{"1":"1044.3752","2":"47.79921819","3":"36417.7811"},{"1":"1675.5147","2":"-46.66262711","3":"34431.7455"},{"1":"548.6818","2":"-20.54256285","3":"15764.4986"},{"1":"1521.7184","2":"-28.04389941","3":"20497.1540"},{"1":"1401.9522","2":"-23.60421233","3":"17254.8968"},{"1":"898.5464","2":"22.25435260","3":"16952.3681"},{"1":"809.2299","2":"-33.85918499","3":"25585.5666"},{"1":"1557.6817","2":"-11.19984011","3":"7725.7159"},{"1":"1656.4290","2":"-0.42612928","3":"661.5856"},{"1":"934.1369","2":"-7.30038846","3":"5376.8592"},{"1":"360.8228","2":"-14.16633001","3":"11123.1418"},{"1":"478.6769","2":"41.18581305","3":"30864.9624"},{"1":"632.6708","2":"-34.06776164","3":"25914.4775"},{"1":"910.5476","2":"-48.88669022","3":"36855.2115"},{"1":"726.8290","2":"5.76703586","3":"4315.3720"},{"1":"1120.5636","2":"30.68341475","3":"23544.5522"},{"1":"889.6793","2":"26.14040242","3":"19883.2780"},{"1":"1570.6285","2":"21.37989290","3":"16946.1707"},{"1":"465.8673","2":"9.17042978","3":"6634.0554"},{"1":"820.8147","2":"23.65292523","3":"17934.6125"},{"1":"427.8628","2":"26.90429904","3":"20011.9092"},{"1":"1416.0105","2":"3.72041122","3":"3449.4465"},{"1":"936.1116","2":"-0.57907628","3":"363.2176"},{"1":"1009.2711","2":"6.86890897","3":"5425.0166"},{"1":"1484.8543","2":"-28.51632186","3":"20890.1122"},{"1":"493.4207","2":"7.64638456","3":"5508.2169"},{"1":"550.6859","2":"0.03913669","3":"233.1539"},{"1":"570.6010","2":"-22.70220094","3":"17376.9439"},{"1":"1038.8125","2":"-31.83844136","3":"23834.5708"},{"1":"864.5711","2":"-45.24441157","3":"34144.4979"},{"1":"1084.1015","2":"-32.09424240","3":"23984.2177"},{"1":"1392.7483","2":"22.65244660","3":"17735.1015"},{"1":"456.7112","2":"-23.84642758","3":"18352.8968"},{"1":"1453.2643","2":"-20.43947696","3":"14811.8238"},{"1":"1052.6134","2":"-20.19915585","3":"15017.0310"},{"1":"616.9943","2":"-29.36831801","3":"22374.6781"},{"1":"1036.5630","2":"-40.55340691","3":"30429.2201"},{"1":"1444.0149","2":"17.93325755","3":"14215.9445"},{"1":"1467.4053","2":"36.34605280","3":"28165.6634"},{"1":"1323.0203","2":"-3.40720669","3":"2073.8709"},{"1":"867.2115","2":"-24.83751983","3":"18704.9278"},{"1":"1392.6339","2":"-36.00775497","3":"26645.8723"},{"1":"1462.8440","2":"-16.36811215","3":"11723.7387"},{"1":"1246.3867","2":"21.32716747","3":"16589.9955"},{"1":"1435.9604","2":"49.11270696","3":"37792.3039"},{"1":"686.5500","2":"26.94969922","3":"20297.8107"},{"1":"1578.6069","2":"18.13070979","3":"14496.7105"},{"1":"642.2999","2":"-18.98858503","3":"14498.3129"},{"1":"1343.5025","2":"-25.16269665","3":"18490.1485"},{"1":"981.8976","2":"-26.90633300","3":"20158.8292"},{"1":"1236.1256","2":"-4.70589397","3":"3130.3478"},{"1":"1779.6786","2":"1.65756531","3":"2265.7664"},{"1":"1401.6978","2":"27.76769609","3":"21612.8759"},{"1":"499.6470","2":"24.69918118","3":"18413.5879"},{"1":"1523.5159","2":"33.59378227","3":"26138.4395"},{"1":"1751.0090","2":"-33.92076208","3":"24720.6244"},{"1":"1127.9998","2":"-30.57474028","3":"22792.3114"},{"1":"851.6455","2":"-49.70666314","3":"37532.6052"},{"1":"1216.8058","2":"-7.39072743","3":"5174.3225"},{"1":"1273.6787","2":"37.35964678","3":"28743.7745"},{"1":"407.1819","2":"38.21238088","3":"28546.1429"},{"1":"1347.0535","2":"5.39691630","3":"4645.2520"},{"1":"426.6880","2":"-39.55890241","3":"30268.1627"},{"1":"1056.1036","2":"41.09384238","3":"31356.8048"},{"1":"549.1217","2":"48.54532192","3":"36500.7465"},{"1":"657.3166","2":"46.74351751","3":"35242.8648"},{"1":"1259.3408","2":"-2.38311300","3":"1370.2472"},{"1":"1581.3686","2":"-11.42848516","3":"7875.7849"},{"1":"608.3286","2":"-35.03387526","3":"26668.9173"},{"1":"740.8313","2":"41.78984270","3":"31576.7074"},{"1":"1668.2744","2":"-21.87302639","3":"15688.5357"},{"1":"998.9364","2":"23.89611534","3":"18292.0039"},{"1":"621.6477","2":"1.29862044","3":"842.7103"},{"1":"349.6979","2":"35.69464146","3":"26585.6632"},{"1":"357.9903","2":"0.87056549","3":"263.9712"},{"1":"1160.0846","2":"-5.38039790","3":"3710.8095"},{"1":"820.1765","2":"29.47686354","3":"22339.5080"},{"1":"818.5580","2":"-11.53041027","3":"8686.5793"},{"1":"1186.8062","2":"-11.75749034","3":"8503.3806"},{"1":"1672.0078","2":"1.44433822","3":"1999.9757"},{"1":"1666.8120","2":"-30.55178137","3":"22253.8052"},{"1":"832.9950","2":"-22.72741722","3":"17141.8920"},{"1":"670.8133","2":"10.05032549","3":"7499.4448"},{"1":"1659.4476","2":"-41.95261418","3":"30884.5037"},{"1":"598.5474","2":"5.37857688","3":"3896.0878"},{"1":"1279.9769","2":"-43.13087349","3":"32143.1630"},{"1":"876.8901","2":"25.30637346","3":"19239.9344"},{"1":"1421.3345","2":"10.03095643","3":"8218.7900"},{"1":"771.2468","2":"-45.57663859","3":"34486.2961"},{"1":"1468.8421","2":"-0.45288987","3":"480.3685"},{"1":"746.7331","2":"25.69217030","3":"19405.0959"},{"1":"1026.6895","2":"-48.81608097","3":"36689.2162"},{"1":"1162.7635","2":"47.75661663","3":"36500.6974"},{"1":"1323.3641","2":"44.11295895","3":"33900.6632"},{"1":"911.8562","2":"42.44745427","3":"32240.4667"},{"1":"911.8698","2":"31.80764117","3":"24191.8542"},{"1":"1772.6970","2":"-45.25164119","3":"33270.3729"},{"1":"1427.9696","2":"-48.99699127","3":"36437.2612"},{"1":"1255.3206","2":"21.12492435","3":"16445.7377"},{"1":"327.2275","2":"-39.25139839","3":"30132.0332"},{"1":"838.1658","2":"-2.46858457","3":"1821.2868"},{"1":"1011.6045","2":"-5.21146306","3":"3724.6386"},{"1":"1534.4237","2":"28.73903813","3":"22476.9404"},{"1":"1727.3678","2":"-22.15265904","3":"15843.0155"},{"1":"1505.3831","2":"46.43459383","3":"35833.9982"},{"1":"1171.9617","2":"31.52645081","3":"24232.2946"},{"1":"772.2326","2":"40.27548379","3":"30461.6655"},{"1":"1342.7814","2":"43.57146777","3":"33509.9461"},{"1":"1312.6657","2":"-16.42309434","3":"11910.0494"},{"1":"1695.7284","2":"-28.10986724","3":"20378.9233"},{"1":"1206.7964","2":"-14.26969445","3":"10383.6911"},{"1":"1153.3191","2":"45.96561086","3":"35136.6803"},{"1":"574.0632","2":"-11.74199237","3":"9082.8394"},{"1":"621.2745","2":"-43.18262087","3":"32820.7016"},{"1":"448.5386","2":"-22.49488560","3":"17338.4153"},{"1":"612.4218","2":"-38.01657597","3":"28921.2893"},{"1":"1211.4319","2":"30.25789771","3":"23311.1524"},{"1":"984.6804","2":"47.44288216","3":"36090.1731"},{"1":"1747.0474","2":"14.22976051","3":"11711.7783"},{"1":"1571.2296","2":"25.44794050","3":"20023.5366"},{"1":"311.5694","2":"-40.91608259","3":"31406.5326"},{"1":"1333.2934","2":"-14.14009864","3":"10163.8358"},{"1":"1146.5621","2":"45.15397197","3":"34516.1330"},{"1":"539.2187","2":"48.39239388","3":"36375.4363"},{"1":"693.3880","2":"-16.64428280","3":"12675.5524"},{"1":"631.4140","2":"-13.40196158","3":"10282.9743"},{"1":"1092.8251","2":"20.35209821","3":"15702.7753"},{"1":"518.5810","2":"-42.43211523","3":"32352.5579"},{"1":"1187.2411","2":"-44.81685089","3":"33508.3610"},{"1":"1334.3380","2":"28.99998603","3":"22479.3524"},{"1":"372.6016","2":"13.35153221","3":"9705.9241"},{"1":"476.5813","2":"24.87562313","3":"18524.6327"},{"1":"1517.8406","2":"35.11725948","3":"27285.2937"},{"1":"1274.2483","2":"29.70917269","3":"22957.2595"},{"1":"1072.0416","2":"-33.73774039","3":"25239.1104"},{"1":"562.3834","2":"-26.79045247","3":"20477.5337"},{"1":"623.6118","2":"-26.65444035","3":"20315.3034"},{"1":"1668.0150","2":"-36.13433868","3":"26475.1978"},{"1":"1784.0343","2":"6.88836004","3":"6201.2857"},{"1":"360.8470","2":"21.61323789","3":"15944.2022"},{"1":"660.5866","2":"-8.19640760","3":"6317.5913"},{"1":"1695.6842","2":"-27.67534424","3":"20050.3217"},{"1":"1129.6777","2":"30.54187789","3":"23446.3617"},{"1":"397.1689","2":"47.75614461","3":"35756.1071"},{"1":"351.3339","2":"48.08487326","3":"35960.2577"},{"1":"559.4683","2":"-10.29983661","3":"8006.1191"},{"1":"1584.9141","2":"16.47432679","3":"13250.3106"},{"1":"909.1201","2":"27.47287434","3":"20910.1411"},{"1":"1501.6460","2":"-47.68033735","3":"35369.9236"},{"1":"566.3188","2":"-5.15925437","3":"4111.8056"},{"1":"1666.6737","2":"-47.48214672","3":"35060.2181"},{"1":"598.4797","2":"-14.70652022","3":"11301.6268"},{"1":"307.5463","2":"19.30485487","3":"14146.1514"},{"1":"850.9555","2":"34.16677443","3":"25917.1813"},{"1":"1153.2705","2":"24.61904688","3":"18989.1754"},{"1":"474.2156","2":"-37.54770088","3":"28700.6254"},{"1":"1046.8153","2":"18.22387963","3":"14048.1934"},{"1":"422.8822","2":"29.66943809","3":"22098.8329"},{"1":"460.4617","2":"28.79571244","3":"21474.4076"},{"1":"350.7385","2":"-26.17400568","3":"20216.4123"},{"1":"963.9275","2":"33.32902226","3":"25393.3632"},{"1":"1573.5102","2":"-10.45712605","3":"7149.4226"},{"1":"1618.0040","2":"-30.38229060","3":"22172.7797"},{"1":"1235.6619","2":"-43.45308668","3":"32429.8256"},{"1":"1351.8333","2":"22.33507552","3":"17455.1569"},{"1":"1309.6903","2":"14.70861987","3":"11646.1556"},{"1":"775.2282","2":"3.92360585","3":"2970.1303"},{"1":"992.3085","2":"2.57891333","3":"2170.8912"},{"1":"470.4530","2":"-9.32963975","3":"7358.3424"},{"1":"1033.0955","2":"7.90709211","3":"6233.0431"},{"1":"1239.0836","2":"10.69017535","3":"8538.6417"},{"1":"1746.0654","2":"-1.11442148","3":"429.1361"},{"1":"353.1976","2":"40.24003278","3":"30027.5741"},{"1":"1312.4306","2":"-28.80312861","3":"21273.7740"},{"1":"1326.5172","2":"-42.48506376","3":"31609.5669"},{"1":"1429.5887","2":"-46.64381852","3":"34655.6329"},{"1":"926.4729","2":"39.63971958","3":"30130.7224"},{"1":"1664.7041","2":"4.00074259","3":"3906.6528"},{"1":"1672.2503","2":"14.60695653","3":"11923.7541"},{"1":"1509.2102","2":"3.22966736","3":"3172.6395"},{"1":"1457.9329","2":"-17.76305775","3":"12783.2971"},{"1":"1004.8294","2":"-1.95081630","3":"1279.5399"},{"1":"502.8691","2":"-34.81970294","3":"26609.1614"},{"1":"498.8652","2":"49.00772444","3":"36801.7118"},{"1":"381.6580","2":"40.56186168","3":"30298.6835"},{"1":"1114.2501","2":"44.36304534","3":"33886.3955"},{"1":"856.5649","2":"-49.12542577","3":"37088.1443"},{"1":"1450.9602","2":"3.47635862","3":"3300.3913"},{"1":"577.3566","2":"41.57927826","3":"31258.5121"},{"1":"1400.5535","2":"-14.52482226","3":"10389.9716"},{"1":"853.4903","2":"-21.05398406","3":"15856.2212"},{"1":"937.0392","2":"20.65641144","3":"15781.1493"},{"1":"919.5561","2":"-25.89391912","3":"19453.3528"},{"1":"1684.1559","2":"-8.85649119","3":"5835.1626"},{"1":"989.3342","2":"-33.44434286","3":"25097.2702"},{"1":"1088.9604","2":"34.75242830","3":"26591.7713"},{"1":"1064.2538","2":"46.13419741","3":"35177.5800"},{"1":"327.2250","2":"-25.46741741","3":"19704.6980"},{"1":"765.9242","2":"-22.53020173","3":"17057.6438"},{"1":"932.0571","2":"-23.52938592","3":"17652.6440"},{"1":"775.5252","2":"4.61708296","3":"3494.1552"},{"1":"532.8310","2":"-48.26741200","3":"36753.0278"},{"1":"825.0615","2":"-0.36268514","3":"303.1377"},{"1":"1190.4840","2":"30.73127356","3":"23648.8300"},{"1":"1782.7037","2":"-12.70191157","3":"8645.0820"},{"1":"1792.6763","2":"-30.97721543","3":"22453.9664"},{"1":"314.5505","2":"-40.44627540","3":"31048.2385"},{"1":"1703.7722","2":"20.88724908","3":"16703.5683"},{"1":"1578.9842","2":"17.35769394","3":"13912.5107"},{"1":"1197.4603","2":"48.87780703","3":"37382.5865"},{"1":"1170.3796","2":"47.55710177","3":"36357.1797"},{"1":"1224.8029","2":"-38.85122221","3":"28959.2567"},{"1":"1670.7124","2":"32.22544196","3":"25246.8429"},{"1":"1095.3456","2":"8.77419421","3":"6949.4713"},{"1":"1217.7845","2":"0.73375143","3":"1023.3757"},{"1":"1587.4657","2":"-1.16170156","3":"391.7952"},{"1":"312.2286","2":"-17.02023721","3":"13329.1361"},{"1":"1279.8005","2":"-42.25431380","3":"31480.2594"},{"1":"728.0843","2":"3.71047531","3":"2762.8285"},{"1":"621.0720","2":"-35.81261477","3":"27245.6588"},{"1":"359.0531","2":"-28.15607940","3":"21707.7471"},{"1":"1438.4239","2":"-47.84731728","3":"35557.4628"},{"1":"986.1637","2":"-26.05662793","3":"19511.9551"},{"1":"1040.9212","2":"39.58272168","3":"30198.9315"},{"1":"1674.5420","2":"-44.42364748","3":"32739.0507"},{"1":"1412.5220","2":"-39.18163469","3":"29027.4435"},{"1":"1148.6171","2":"34.18713650","3":"26222.2192"},{"1":"959.6725","2":"-31.86487979","3":"23931.2112"},{"1":"355.7581","2":"-15.29646486","3":"11982.9576"},{"1":"717.2916","2":"34.87587792","3":"26323.5963"},{"1":"690.3891","2":"48.96533622","3":"36955.7677"},{"1":"1454.6395","2":"13.24753258","3":"10683.0490"},{"1":"874.4339","2":"7.70667519","3":"5926.1777"},{"1":"1750.6262","2":"-36.74269363","3":"26855.4639"},{"1":"1206.1218","2":"-27.19113023","3":"20157.2794"},{"1":"652.3113","2":"39.20980305","3":"29538.9157"},{"1":"943.1548","2":"-38.98984289","3":"29336.9499"},{"1":"318.3364","2":"48.18161167","3":"36001.3848"},{"1":"348.0609","2":"35.89188252","3":"26733.2821"},{"1":"902.7591","2":"-22.16254016","3":"16647.0813"},{"1":"647.8829","2":"10.67960376","3":"7953.0152"},{"1":"1718.3646","2":"-8.09408515","3":"5227.4699"},{"1":"969.1009","2":"-6.33240021","3":"4611.8322"},{"1":"1043.2966","2":"23.21432622","3":"17819.4955"},{"1":"1018.6947","2":"29.49442989","3":"22545.9899"},{"1":"1084.2036","2":"-24.38561975","3":"18153.1040"},{"1":"675.6166","2":"33.33210258","3":"25115.2510"},{"1":"1343.1800","2":"-37.53538660","3":"27849.2884"},{"1":"441.1540","2":"-16.61547918","3":"12897.9950"},{"1":"1365.5333","2":"-22.80168971","3":"16683.0963"},{"1":"939.5246","2":"-19.12176576","3":"14311.4479"},{"1":"910.3195","2":"22.05437412","3":"16812.5651"},{"1":"1151.0950","2":"26.56295376","3":"20457.4507"},{"1":"1417.4608","2":"36.50442155","3":"28236.8253"},{"1":"914.8860","2":"49.71599991","3":"37741.8591"},{"1":"1574.5960","2":"-13.67454117","3":"9579.7833"},{"1":"1726.0146","2":"17.77208734","3":"14369.5490"},{"1":"1372.9861","2":"34.73266710","3":"26853.3106"},{"1":"1685.4364","2":"-14.76249916","3":"10295.6872"},{"1":"760.3923","2":"49.87054067","3":"37708.5766"},{"1":"1423.3153","2":"-36.92435857","3":"27309.5226"},{"1":"1111.8472","2":"-48.29829088","3":"36214.9928"},{"1":"1539.7392","2":"33.26619768","3":"25906.4549"},{"1":"1490.0012","2":"-18.30903394","3":"13165.2540"},{"1":"1153.7344","2":"-39.43832950","3":"29472.2034"},{"1":"548.8316","2":"21.42386341","3":"15983.7591"},{"1":"1506.9375","2":"-17.13282638","3":"12259.5028"},{"1":"1361.1353","2":"-19.18002968","3":"13948.2348"},{"1":"919.8998","2":"39.27597038","3":"29849.1656"},{"1":"983.3171","2":"-3.08118130","3":"2145.6523"},{"1":"458.8951","2":"37.90113511","3":"28360.9432"},{"1":"498.9808","2":"-43.61438064","3":"33265.9310"},{"1":"854.0330","2":"-47.40109777","3":"35786.1892"},{"1":"1118.4618","2":"-12.37326120","3":"9034.7760"},{"1":"542.8312","2":"13.79045250","3":"10203.6512"},{"1":"1579.7505","2":"13.38156294","3":"10906.7911"},{"1":"621.4762","2":"28.72685636","3":"21578.8742"},{"1":"429.5834","2":"20.18467304","3":"14930.3673"},{"1":"363.9144","2":"-5.27838324","3":"4397.0595"},{"1":"917.9721","2":"-25.19121643","3":"18923.3363"},{"1":"1264.9399","2":"-31.60167157","3":"23436.5763"},{"1":"1410.0151","2":"-28.34142928","3":"20830.1780"},{"1":"871.6481","2":"-25.73402254","3":"19378.7836"},{"1":"532.1301","2":"47.92703916","3":"36016.5160"},{"1":"928.8211","2":"11.74347473","3":"9031.8017"},{"1":"1429.0661","2":"45.47899985","3":"35036.8680"},{"1":"524.3130","2":"-49.70709700","3":"37850.3862"},{"1":"1200.3186","2":"46.83750081","3":"35841.9509"},{"1":"1534.5753","2":"0.94730256","3":"1495.9019"},{"1":"1323.0454","2":"-38.32190724","3":"28463.7344"},{"1":"1235.1699","2":"29.17781037","3":"22517.2656"},{"1":"1422.1236","2":"-40.51927924","3":"30029.9913"},{"1":"1334.6094","2":"-34.34749427","3":"25446.1625"},{"1":"506.7882","2":"-4.08530054","3":"3357.1283"},{"1":"1143.1742","2":"3.19654958","3":"2785.0390"},{"1":"1222.2568","2":"25.98942118","3":"20092.9454"},{"1":"1562.4804","2":"-43.00245121","3":"31772.4802"},{"1":"475.4052","2":"48.76348502","3":"36594.1546"},{"1":"1411.6362","2":"18.15633602","3":"14353.0394"},{"1":"737.9805","2":"49.02585607","3":"37047.8072"},{"1":"1205.6379","2":"-24.14732664","3":"17855.4189"},{"1":"1273.0833","2":"-38.04079727","3":"28299.4642"},{"1":"717.3929","2":"-39.18716295","3":"29705.0335"},{"1":"1230.7196","2":"3.59635002","3":"3172.7096"},{"1":"303.4852","2":"-33.23804364","3":"25606.0653"},{"1":"913.3682","2":"13.36213748","3":"10240.8913"},{"1":"877.3875","2":"16.21047796","3":"12360.1383"},{"1":"452.4655","2":"45.56013094","3":"34148.5846"},{"1":"555.9429","2":"19.60988755","3":"14618.4814"},{"1":"1142.0133","2":"30.07308403","3":"23103.7599"},{"1":"535.2951","2":"27.00283376","3":"20190.8974"},{"1":"1237.1859","2":"-22.19057484","3":"16344.8853"},{"1":"856.8579","2":"-22.42881055","3":"16892.9179"},{"1":"708.4225","2":"-37.88970110","3":"28732.2347"},{"1":"1186.0874","2":"-16.89941024","3":"12392.3732"},{"1":"1235.2194","2":"30.34640315","3":"23401.2647"},{"1":"1793.8762","2":"-45.91481225","3":"33751.5160"},{"1":"1073.5447","2":"-32.39889187","3":"24224.8892"},{"1":"1714.2897","2":"-33.26152903","3":"24257.4909"},{"1":"1258.3222","2":"13.66351759","3":"10805.6565"},{"1":"890.0973","2":"26.85107356","3":"20421.2677"},{"1":"1195.6325","2":"30.20511370","3":"23255.8401"},{"1":"930.3986","2":"-43.34982429","3":"32647.4912"},{"1":"824.3871","2":"1.83646565","3":"1446.6978"},{"1":"799.5679","2":"16.42980555","3":"12450.1897"},{"1":"1551.6503","2":"20.29608316","3":"16107.9700"},{"1":"927.2661","2":"-28.09807821","3":"21113.2046"},{"1":"654.7710","2":"20.46244242","3":"15359.5715"},{"1":"1460.3151","2":"-47.01597497","3":"34907.3934"},{"1":"1034.5360","2":"-18.64537329","3":"13859.2656"},{"1":"1506.9913","2":"45.76403527","3":"35328.3211"},{"1":"1636.4231","2":"-21.05174277","3":"15098.1686"},{"1":"509.3375","2":"-26.74395123","3":"20493.7771"},{"1":"596.9036","2":"24.81426217","3":"18595.2300"},{"1":"1797.1505","2":"43.12957174","3":"33618.0065"},{"1":"1712.0823","2":"-24.68090949","3":"17769.7712"},{"1":"365.8904","2":"28.47936295","3":"21143.1750"},{"1":"896.8695","2":"-27.51143039","3":"20698.8714"},{"1":"913.1551","2":"2.94673876","3":"2369.3629"},{"1":"317.8169","2":"43.37747458","3":"32366.6256"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Que tal a gente ver o nosso progresso até agora colocando os melhores modelos em relação aos nossos dados?</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="co"># Selecionando os 10 melhores modelos (menor distância)</span></a>
<a class="sourceLine" id="cb57-2" title="2">melhores &lt;-<span class="st"> </span>modelos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb57-3" title="3"></a>
<a class="sourceLine" id="cb57-4" title="4"><span class="co"># Gráfico</span></a>
<a class="sourceLine" id="cb57-5" title="5">g <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(</a>
<a class="sourceLine" id="cb57-6" title="6">  <span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2, <span class="dt">color =</span> <span class="op">-</span>dist),</a>
<a class="sourceLine" id="cb57-7" title="7">  <span class="dt">data =</span> melhores</a>
<a class="sourceLine" id="cb57-8" title="8">)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/model6-1.png" width="672" /></p>
<p>Como vocês podem ver, conseguimos identificar alguns modelos que representam melhor a relação entre idade e renda. Isso não significa que encontramos o modelo correto, ou que essa relação é verdadeira, pois isso precisa ser construído como argumento, fundamentado em evidência. Mas esse é um processo através do qual você pode chegar a um modelo.</p>
</div>
<div id="modelando-em-r" class="section level2">
<h2>Modelando em R</h2>
<p>Em geral, não é necessário repetir esse processo manual de modelagem. Através de algoritmos já implementados em R, podemos implementar um modelo linear com poucas linhas de códigos. É importante, no entanto, que a gente entenda o que está acontecendo “por debaixo do capô”, por isso inclui essa explicação longa. Agora, vamos ver como encontraríamos um modelo linear usando o R.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1">modelo_renda &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> renda_pc_med <span class="op">~</span><span class="st"> </span>idade_media, <span class="dt">data =</span> medias_sexo)</a>
<a class="sourceLine" id="cb58-2" title="2"><span class="kw">summary</span>(modelo_renda)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = renda_pc_med ~ idade_media, data = medias_sexo)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -394.64 -109.40   -5.76   89.04  991.35 
## 
## Coefficients:
##             Estimate Std. Error t value      Pr(&gt;|t|)    
## (Intercept)    62.92     112.44   0.560         0.576    
## idade_media    20.23       3.38   5.985 0.00000000378 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 176.2 on 584 degrees of freedom
## Multiple R-squared:  0.05779,    Adjusted R-squared:  0.05618 
## F-statistic: 35.82 on 1 and 584 DF,  p-value: 0.000000003777</code></pre>
<p>A interpretação correta de um modelo envolve um bom conhecimento de tópicos da estatística, como a análise de regressão linear, análise dos valores preditos, análise dos resíduos, dos p-valores, e muitas outras coisas. O que gostaria que vocês levassem daqui é uma ideia geral sobre o que os modelos são e como são construídos, e como eles podem ser implementados em R sem muita dificuldade. Pra encerrar, vamos ver nosso modelo lado a lado com os dados.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1">g <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x)</a></code></pre></div>
<p><img src="03_aula-3_files/figure-html/model-smooth-1.png" width="672" /></p>
<p>Quem quiser aprender mais sobre modelagem, eu recomendo <a href="https://r4ds.had.co.nz/model-basics.html">o capítulo sobre modelos</a> do R for Data Science, que é bem didático. Precisa ter um pouquinho de background sobre funções, mas também dá pra aprender muita coisa no próprio livro.</p>
</div>
</div>
<div id="exercício" class="section level1">
<h1>Exercício</h1>
<div id="construção-de-variáveis-derivadas-de-idade" class="section level2">
<h2>Construção de variáveis derivadas de idade</h2>
</div>
<div id="gráficos-para-exploração-dos-dados" class="section level2">
<h2>Gráficos para exploração dos dados</h2>
</div>
<div id="um-modelo-linear-de-renda-por-anos-de-estudo" class="section level2">
<h2>Um modelo linear de renda por anos de estudo</h2>
</div>
</div>

<p>Copyright &copy; 2020 Vinícius Maia. Nenhum Direito a menos.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
