<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Bancos de dados em R - Leitura e operações</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Oficina de R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html"></a>
</li>
<li>
  <a href="02_bancos-de-dados-em-r.html"></a>
</li>
<li>
  <a href="03_controle-de-fluxo.html"></a>
</li>
<li>
  <a href="04_visualizacoes-em-R.html"></a>
</li>
<li>
  <a href="05_manipulacao-dplyr.html"></a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Bancos de dados em R - Leitura e operações</h1>
<h4 class="date">30/03/2020</h4>

</div>


<div id="bancos-de-dados-em-r" class="section level1">
<h1>Bancos de dados em R</h1>
<p>Trabalhar com bancos de dados em R não difere muito de outros softwares estatísticos, como Stata, SPSS, SAS, etc. De uma maneira geral, são feitas as mesmas operações: <em>leitura, escrita, criação de variáveis auxiliares, filtragens de casos, seleção de variáveis, reformatação do banco</em>, etc.</p>
<p>Há apenas duas coisas que alguém que já trabalhou com bancos de dados antes precisa saber: <em>traduzir</em> a operação para o R, utilizando a função adequada, com os argumentos necessários e <em>trabalhar com a memória RAM</em> do computador.</p>
<div id="traduzindo-para-o-r" class="section level2">
<h2>Traduzindo para o R</h2>
<p>A melhor maneira de ilustrar essa ideia de tradução é pensar em algumas operações que realizamos de maneira corriqueira em nossos bancos de dados. Uma das operações mais comuns é a utilização de frequências de variáveis categóricas. No SPSS utilizariamos a Interface Gráfica para ir até Analisar &gt; Frequencias &gt; Selecionamos uma variável &gt; Selecionamos opções &gt; Executamos. Ou, utilizamos a linha de comando para executar a mesma operação.</p>
<p>No R, utilizariamos a função <code>table</code>, e faríamos:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">data</span>(<span class="st">&quot;iris&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">print</span>(iris, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 145 rows ]</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">table</span>(iris<span class="op">$</span>Species)</a></code></pre></div>
<pre><code>## 
##     setosa versicolor  virginica 
##         50         50         50</code></pre>
<p>O que nos informa que no banco de dados “iris” foram feitas medidas para 50 flores de cada uma das 3 espécies <em>setosa, versicolor e virginica</em>.</p>
<p>De maneira geral, se você já trabalhou com algum pacote estatístico antes, a questão é realmente aprender qual o comando adequado para realizar a mesma operação em R.</p>
</div>
<div id="leitura-de-bancos-de-dados" class="section level2">
<h2>Leitura de bancos de dados</h2>
<p>Bancos de dados vem em vários formatos, alguns deles proprietários dos softwares que os utilizam, mas podemos classificá-los em basicamente dois tipos: delimitados e largura fixa.</p>
<p>Em bancos de dados <strong>delimitados</strong> temos uma estrutura da seguinte forma</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>],</a>
<a class="sourceLine" id="cb5-2" title="2">                 <span class="dt">b =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb5-3" title="3">                 <span class="dt">c =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>), <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">write.table</span>(df, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## &quot;a&quot;;&quot;b&quot;;&quot;c&quot;
## &quot;a&quot;;1;TRUE
## &quot;b&quot;;2;FALSE
## &quot;c&quot;;3;TRUE
## &quot;d&quot;;4;FALSE
## &quot;e&quot;;5;TRUE
## &quot;f&quot;;6;FALSE
## &quot;g&quot;;7;TRUE
## &quot;h&quot;;8;FALSE
## &quot;i&quot;;9;TRUE
## &quot;j&quot;;10;FALSE</code></pre>
<p>Note que o resultado de <code>write.table()</code>, que exploraremos mais adiante, é um banco de dados em que as colunas estão separadas por <code>;</code>.</p>
<p>Em bancos de dados <strong>largura fixa</strong> ou <strong>colunado</strong>, o dado está guardado na forma de sequências longas de números que precisam ser interpretados segundo um arquivo dicionário que informa em que posição encontra-se cada informação. Assim são os dados do IBGE.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb7-2" title="2">                 <span class="dt">b =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb7-3" title="3">                 <span class="dt">c =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw">write.table</span>(df, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">col.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## 111
## 220
## 331
## 440
## 551
## 660
## 771
## 880
## 991
## 10100</code></pre>
<p>O formato desse segundo write.table exigiria que conhecessemos a posição de cada informação, para poder lê-la adequadamente, peço que ignorem a décima linha por enquanto. Vamos começar então a ler alguns bancos de dados.</p>
<div id="delimitado" class="section level3">
<h3>Delimitado</h3>
<p>Para praticar, descompactem o arquivo <code>extrato_censo.7z</code> e vamos começar a ler os arquivos. A função que vamos utilizar se chama <code>read.table</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">dado &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> <span class="st">&quot;01_extrato_censo_2010.txt&quot;</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>##   UF MUNIC      PESO SEXO IDADE EDUC   RENDA
## 1 35  1608 11.287026    2    57    4 9.80392
## 2 35  1608  8.446364    2    46    4 6.27451
## 3 35  1608  8.446364    1    48    4 9.80392
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 226902 rows ]</code></pre>
<p>Notem que o único argumento que utilizamos foi <code>file</code> para <strong>indicar o caminho do arquivo</strong>.</p>
<hr />
<p>Vamos abrir um parêntese aqui para aprender como trabalhar com caminhos de arquivo em R.</p>
<p>Vejam que quando chamei a função <code>read.table</code>, eu não precisei especificar o <em>caminho</em> do arquivo, apenas o seu <em>nome</em>. Isso se chama caminho <strong>relativo</strong>. O R armazena uma variável chamada <strong>working directory</strong> ou pasta de trabalho, que pode ser vista ou modificada usando os seguintes comandos:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">getwd</span>()</a></code></pre></div>
<pre><code>## [1] &quot;C:/Users/vinic/Documents/R/oficina-de-r&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">setwd</span>(<span class="st">&quot;C:/Users/vinic/Documents/R/curso2&quot;</span>)</a></code></pre></div>
<p><code>getwd()</code> informa qual a atual pasta de trabalho, enquanto <code>setwd()</code> modifica a pasta de trabalho de acordo com o valor informado.</p>
<p>A qualquer momento, você também utilizar o caminho <strong>absoluto</strong> de um arquivo.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">dado &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">  </span><span class="kw">read.table</span>(<span class="st">&quot;C:/Users/vinic/Documents/R/oficina-de-r/01_extrato_censo_2010.txt&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>##   UF MUNIC      PESO SEXO IDADE EDUC   RENDA
## 1 35  1608 11.287026    2    57    4 9.80392
## 2 35  1608  8.446364    2    46    4 6.27451
## 3 35  1608  8.446364    1    48    4 9.80392
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 226902 rows ]</code></pre>
<p>Se você está no RStudio, você vai notar que ele tem duas ferramentas que nos ajudam a trabalhar com caminhos de arquivo. Uma é <strong>autocompletar</strong> caminhos de pasta quando você abre <code>"</code>. E a outra é a criação de <code>R Projects</code>, que pode ser encontrada na parte superior esquerda da interface. Experimente criar um projeto para este curso, apontando uma pasta (que você pode criar) onde ficarão guardados os arquivos que vamos utilizar.</p>
<hr />
<p>Vamos tentar abrir o segundo arquivo delimitado, <code>"02_extrato_censo_2010.txt"</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">dado &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;02_extrato_censo_2010.txt&quot;</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>##    V1                                                V2
## 1  UF     ,&quot;MUNIC&quot;,&quot;PESO&quot;,&quot;SEXO&quot;,&quot;IDADE&quot;,&quot;EDUC&quot;,&quot;RENDA&quot;
## 2   1 ,&quot;35&quot;,&quot;01608&quot;,11.2870255906736,&quot;2&quot;,57,&quot;4&quot;,9.80392
## 3   2  ,&quot;35&quot;,&quot;01608&quot;,8.4463640405632,&quot;2&quot;,46,&quot;4&quot;,6.27451
## 4   3  ,&quot;35&quot;,&quot;01608&quot;,8.4463640405632,&quot;1&quot;,48,&quot;4&quot;,9.80392
## 5   4  ,&quot;35&quot;,&quot;01608&quot;,7.8222591662318,&quot;2&quot;,39,&quot;3&quot;,3.92157
## 6   5        ,&quot;35&quot;,&quot;01608&quot;,7.8222591662318,&quot;2&quot;,14,&quot;1&quot;,0
## 7   6 ,&quot;35&quot;,&quot;01608&quot;,11.5416196380749,&quot;2&quot;,69,&quot;3&quot;,0.58824
## 8   7        ,&quot;35&quot;,&quot;01608&quot;,8.5037192050286,&quot;2&quot;,76,&quot;1&quot;,0
## 9   8  ,&quot;35&quot;,&quot;01608&quot;,8.5037192050286,&quot;1&quot;,82,&quot;1&quot;,6.47059
## 10  9        ,&quot;35&quot;,&quot;01608&quot;,7.6531890642122,&quot;1&quot;,17,&quot;2&quot;,0
## 11 10 ,&quot;35&quot;,&quot;01608&quot;,7.6531890642122,&quot;1&quot;,47,&quot;4&quot;,29.41176
## 12 11 ,&quot;35&quot;,&quot;01608&quot;,11.3748043237706,&quot;1&quot;,58,&quot;4&quot;,1.96078
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 226894 rows ]</code></pre>
<p>Veja nossa operação não resultou num banco de dados organizado. Foram lidas apenas 2 variáveis, V1 e V2 e os dados ficaram desorganizados. O que ocorre é um problema com o separador das colunas. <code>read.table</code> tem um valor padrão igual <code>" "</code> para o separador de colunas, o que significa que ele entende <strong>um</strong> espaço em branco como a separação entre os dados. Nesse banco de dados, veja que as colunas estão separadas por <code>,</code>. Então, para lê-lo adequadamente, escrevemos:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">dado &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;02_extrato_censo_2010.txt&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>##   UF MUNIC      PESO SEXO IDADE EDUC   RENDA
## 1 35  1608 11.287026    2    57    4 9.80392
## 2 35  1608  8.446364    2    46    4 6.27451
## 3 35  1608  8.446364    1    48    4 9.80392
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 226902 rows ]</code></pre>
<p>Vamos tentar ler o arquivo <code>"05_extrato_censo_2010.txt"</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">dado &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;05_extrato_censo_2010.txt&quot;</span>)</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>##   UF MUNIC             PESO SEXO IDADE EDUC   RENDA
## 1 35  1608 11,2870255906736    2    57    4 9,80392
## 2 35  1608  8,4463640405632    2    46    4 6,27451
## 3 35  1608  8,4463640405632    1    48    4 9,80392
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 226902 rows ]</code></pre>
<p>Até que conseguimos ler o banco de dados, mas veja que nossas variáveis númericas PESO e RENDA estão com o tipo <code>factor</code>, utilizado para variáveis categóricas. Isto ocorre porque ele leu as vírgulas nos números de maneira incorreta. Para corrigir este erro, utilizamos o argumento opcional <code>dec = ","</code> que muda o separador de casas decimais:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">dado &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;05_extrato_censo_2010.txt&quot;</span>, <span class="dt">dec =</span> <span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb22-2" title="2"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>##   UF MUNIC      PESO SEXO IDADE EDUC   RENDA
## 1 35  1608 11.287026    2    57    4 9.80392
## 2 35  1608  8.446364    2    46    4 6.27451
## 3 35  1608  8.446364    1    48    4 9.80392
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 226902 rows ]</code></pre>
<div id="exercício" class="section level4">
<h4>Exercício</h4>
<p>Leiam o resto dos bancos de dados utilizando os separadores de colunas e decimais adequados.</p>
</div>
</div>
<div id="largura-fixa" class="section level3">
<h3>Largura fixa</h3>
<p>Um dos bancos de dados mais importantes para os demógrafos é corriqueiramente publicado pelo IBGE no formato largura-fixa, acompanhado de um arquivo de leiaute que informa as posições das variáveis e os seus valores possíveis. Para tanto, descompactem o arquivo <code>"censo2010SPOutros.7z"</code>.</p>
<p>Abrir arquivos de largura fixa é um processo bastante trabalhoso, é necessário consultar a posição de cada variável no arquivo de leiaute, bem como aplicar um passo posterior para separar os valores decimais.</p>
<p>Normalmente, você executaria este trabalho usando a função <code>read.fwf</code>, mas esta função tem uma versão melhorada, mais rápida e fácil de usar, chamada <code>read_fwf</code>. Ela, no entanto, encontra-se em um <strong>pacote</strong> que não está no R Base e precisa ser instalado a parte. Vamos então, abrir um parêntese para aprender a instalar pacotes em R.</p>
<hr />
<p>Instalar pacotes ou bibliotecas em R é extremamente fácil, você só precisa saber o nome do pacote e seguir um desses dois caminhos:</p>
<p>Pela interface gráfica, clique na aba “Packages” e clique em Install. Na Janela que se abriu, digite o nome do pacote e clique no botão Install.</p>
<p>Pela linha de comando, utilize o comando <code>install.packages("pacote")</code>, como no exemplo a seguir:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;readr&quot;</span>)</a></code></pre></div>
<p>Se tudo correr bem durante a instalação, é só começar a usar o pacote.</p>
<hr />
<p>Ok, agora que já temos o pacote readr instalado na nossa versão do R, precisamos carregar ele no <strong>Namespace</strong> do R. Esse treco aí é apenas para dizer que o R passa a reconhecer os nomes do pacote (no nosso caso, interessa que ele reconheça o <code>read_fwf</code>) quando você os digitar. Vamos ver, execute o código a seguir linha por linha e veja o console:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">read_fwf</span>(<span class="dt">file =</span> <span class="st">&quot;Amostra_Pessoas_14.txt&quot;</span>, </a>
<a class="sourceLine" id="cb25-2" title="2">         <span class="kw">fwf_cols</span>(<span class="dt">V0001 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)), </a>
<a class="sourceLine" id="cb25-3" title="3">         <span class="dt">n_max =</span> <span class="dv">25</span>)</a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb26-2" title="2"></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="kw">read_fwf</span>(<span class="dt">file =</span> <span class="st">&quot;Amostra_Pessoas_14.txt&quot;</span>, </a>
<a class="sourceLine" id="cb26-4" title="4">         <span class="kw">fwf_cols</span>(<span class="dt">V0001 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)), </a>
<a class="sourceLine" id="cb26-5" title="5">         <span class="dt">n_max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   V0001 = col_double()
## )</code></pre>
<pre><code>## # A tibble: 25 x 1
##    V0001
##    &lt;dbl&gt;
##  1    14
##  2    14
##  3    14
##  4    14
##  5    14
##  6    14
##  7    14
##  8    14
##  9    14
## 10    14
## # ... with 15 more rows</code></pre>
<p>Vejam que os códigos são idênticos, mas no primeiro caso, o R não consegue encontrar a função <code>read_fwf</code>, pois ele não está no <strong>Namespace</strong>. O comando <code>library()</code> carrega o pacote <code>readr</code> e permite que o R encontre a função.</p>
<p>Para que esta função leia o nosso banco, precisamos especificar a posição das variáveis no banco, que está descrito no arquivo de leiaute. Como exemplo, vamos ler as primeiras 3 variáveis que encontramos nos nossos arquivos delimitados, UF, MUNICÍPIO e PESO AMOSTRAL.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">dado &lt;-<span class="st"> </span><span class="kw">read_fwf</span>(</a>
<a class="sourceLine" id="cb29-2" title="2">  <span class="dt">file =</span> <span class="st">&quot;Amostra_Pessoas_14.txt&quot;</span>,</a>
<a class="sourceLine" id="cb29-3" title="3">  <span class="kw">fwf_cols</span>(</a>
<a class="sourceLine" id="cb29-4" title="4">    <span class="dt">UF    =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb29-5" title="5">    <span class="dt">MUNIC =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb29-6" title="6">    <span class="dt">PESO  =</span> <span class="kw">c</span>(<span class="dv">29</span>, <span class="dv">44</span>)</a>
<a class="sourceLine" id="cb29-7" title="7">  ),</a>
<a class="sourceLine" id="cb29-8" title="8">  <span class="dt">col_types =</span> <span class="kw">cols_only</span>(</a>
<a class="sourceLine" id="cb29-9" title="9">    <span class="dt">UF    =</span> <span class="kw">col_character</span>(),</a>
<a class="sourceLine" id="cb29-10" title="10">    <span class="dt">MUNIC =</span> <span class="kw">col_character</span>(),</a>
<a class="sourceLine" id="cb29-11" title="11">    <span class="dt">PESO  =</span> <span class="kw">col_double</span>()</a>
<a class="sourceLine" id="cb29-12" title="12">  ),</a>
<a class="sourceLine" id="cb29-13" title="13">  <span class="dt">n_max =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb29-14" title="14"></a>
<a class="sourceLine" id="cb29-15" title="15"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1,000 x 3
##    UF    MUNIC    PESO
##    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1 14    00027 3.24e13
##  2 14    00027 3.24e13
##  3 14    00027 8.21e13
##  4 14    00027 8.21e13
##  5 14    00027 8.21e13
##  6 14    00027 8.21e13
##  7 14    00027 8.21e13
##  8 14    00027 8.21e13
##  9 14    00027 3.95e13
## 10 14    00027 3.95e13
## # ... with 990 more rows</code></pre>
<p>Note que além de especificar as posições das variáveis <code>fwf_cols(nome = c(início, fim))</code>, eu fiz questão de especificar também os tipos das colunas <code>col_types = cols_only(nome = col_tipo())</code>, porque não quero que ele interprete os valores de UF e MUNIC como números, já que são códigos de estados e municípios e também específico que peso é uma variável númerica. Porém, Isto é insuficiente, já que PESO não está com as suas casas decimas! Veja que PESO tem 3 casas antes da vírgula e 13 casas após. Então, precisamos fazer:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">dado<span class="op">$</span>PESO &lt;-<span class="st"> </span>dado<span class="op">$</span>PESO <span class="op">/</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">13</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="kw">print</span>(dado, <span class="dt">max =</span> <span class="dv">25</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1,000 x 3
##    UF    MUNIC  PESO
##    &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
##  1 14    00027  3.24
##  2 14    00027  3.24
##  3 14    00027  8.21
##  4 14    00027  8.21
##  5 14    00027  8.21
##  6 14    00027  8.21
##  7 14    00027  8.21
##  8 14    00027  8.21
##  9 14    00027  3.95
## 10 14    00027  3.95
## # ... with 990 more rows</code></pre>
<p>Infelizmente, o R base não tem um jeito muito elegante de lidar com as casas decimais no banco de dados do IBGE, então é necessário repetir este passo para todas as suas variáveis númericas que tenham casas decimais. Note que <code>dado$PESO</code> é a nossa forma de referênciar o vetor <code>PESO</code> que está armanzenado no data.frame <code>dado</code> e, se assim desejarmos, fazer alterações nele.</p>
</div>
</div>
<div id="escrevendo-bancos-de-dados" class="section level2">
<h2>Escrevendo bancos de dados</h2>
<p>Muitas vezes, este é nosso último passo, para salvar tabelas ou bancos de dados atualizados após concluirmos nossas análises, porém, vamos aproveitar que o <code>read.table</code> está fresco na nossa memória aprender a usar seu primo, <code>write.table</code>, já que eles são muito similares.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">write.table</span>(<span class="dt">x =</span> dado, <span class="dt">file =</span> <span class="st">&quot;01_arquivo_teste.txt&quot;</span>)</a></code></pre></div>
<p>Agora abra na sua pasta o arquivo que você criou e veja que formato ele assumiu.</p>
</div>
<div id="exercício-1" class="section level2">
<h2>Exercício</h2>
<p>Utilize os argumentos <code>sep</code> e <code>dec</code> para gravar o banco de dados <code>dado</code> em todos os formatos que os bancos <code>"XX_extrato_censo_2010.txt"</code> têm e nomeie os arquivos segundo a mesma lógica, de 01 a 07.</p>
</div>
</div>
<div id="operações-com-bancos-de-dados" class="section level1">
<h1>Operações com Bancos de dados</h1>
<div id="visualizando-nosso-banco-direta-e-indiretamente" class="section level2">
<h2>Visualizando nosso banco direta e indiretamente</h2>
<p>Para visualizar os bancos de dados, vamos utilizar o nosso arquivo <code>"06_extrato_censo_2010.txt"</code>. Como já sabemos o formato do arquivo, podemos utilizar a função auxiliar <code>read.csv2</code>, que é uma versão de <code>read.table</code> com valores pré-definidos para <code>sep</code> e <code>dec</code>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">dado &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(</a>
<a class="sourceLine" id="cb34-2" title="2">  <span class="dt">file =</span> <span class="st">&quot;06_extrato_censo_2010.txt&quot;</span>, </a>
<a class="sourceLine" id="cb34-3" title="3">  <span class="dt">colClasses =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb34-4" title="4">    <span class="dt">UF    =</span> <span class="st">&quot;character&quot;</span>,</a>
<a class="sourceLine" id="cb34-5" title="5">    <span class="dt">MUNIC =</span> <span class="st">&quot;character&quot;</span>,</a>
<a class="sourceLine" id="cb34-6" title="6">    <span class="dt">SEXO  =</span> <span class="st">&quot;character&quot;</span>,</a>
<a class="sourceLine" id="cb34-7" title="7">    <span class="dt">EDUC  =</span> <span class="st">&quot;character&quot;</span>))</a></code></pre></div>
<p>Podemos visualizar nossos dados em R de várias formas. Podemos imprimí o objeto no console digitando o seu nome ou utilizando a função <code>print</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">dado</a>
<a class="sourceLine" id="cb35-2" title="2"><span class="co"># ou</span></a>
<a class="sourceLine" id="cb35-3" title="3"><span class="kw">print</span>(dado)</a></code></pre></div>
<p>Também podemos abrir uma visualização ao estilo Excel, com algumas funcionalidades como filtros para as linhas e colunas com <code>View</code>, mas atenção, não é possível alterar manualmente os valores.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">View</span>(dado)</a></code></pre></div>
<p>Outra forma de “visualizar” nossos dados é utilizar medidas resumo da distribuição das variáveis, como médias e variáveis de distribuição. Experimente as seguintes funções sobre a variável numérica de renda. Algumas dessas funções também tem métodos para variáveis não numéricas, como <code>summary</code>. Estamos trabalhando sem considerar a necessidade de ponderar os valores.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">mean</span>(dado<span class="op">$</span>RENDA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 2.348011</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">median</span>(dado<span class="op">$</span>RENDA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.37255</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">var</span>(dado<span class="op">$</span>RENDA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 39.438</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">sd</span>(dado<span class="op">$</span>RENDA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 6.279968</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">range</span>(dado<span class="op">$</span>RENDA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1]    0.000 1085.294</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="kw">quantile</span>(dado<span class="op">$</span>RENDA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##         0%        25%        50%        75%       100% 
##    0.00000    0.00000    1.37255    2.54902 1085.29412</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">summary</span>(dado<span class="op">$</span>RENDA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA&#39;s 
##    0.000    0.000    1.373    2.348    2.549 1085.294    29550</code></pre>
<p>Outra forma é fazer isto graficamente. Trabalhar com gráficos em R requer um pouco mais de aprofundamento nos argumentos opcionais das funções, porém, os resultados são muito interessantes e informativos.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="kw">hist</span>(dado<span class="op">$</span>RENDA, <span class="dt">breaks =</span> <span class="dv">1000</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</a></code></pre></div>
<p><img src="02_bancos-de-dados-em-r_files/figure-html/grafico-1.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">boxplot</span>(dado<span class="op">$</span>RENDA, <span class="dt">outline =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="02_bancos-de-dados-em-r_files/figure-html/grafico-2.png" width="672" /></p>
<p>Essencialmente, a visualização de dados em R não é muito distinta de outros softwares. Geralmente, é mais proveitoso analisar medidas resumo e representações gráficas do que inspecionar microdados individualmente.</p>
</div>
<div id="selecionando-casos-e-variáveis" class="section level2">
<h2>Selecionando casos e variáveis</h2>
<p>Frequentemente, trabalhamos com grandes bancos de dados que contém informações, lugares ou pessoas que não tem relevância para a nossa pergunta de pesquisa. Para operacionalizar nossas questões, é necessário então selecionar casos relevantes e descartar outros. Esta é uma operação tão básica e frequente, que há múltiplos pacotes em R que apresentam soluções para isto. Aqui, vou me ater ao jeito <code>[]</code>. O bom do jeito <code>[]</code> é que ele sempre funciona, independente do pacote que você está utilizando e ele oferece um conhecimento fundamental que você pode depois traduzir para outros pacotes de processamento de dados como o <code>data.table</code> e o <code>dplyr</code>.</p>
<p><code>[]</code> É a função Extract. Ela serve para “pescar” elementos dentro de um objeto ou modificar partes dele. É ela que vamos utilizar para fazer nossas seleções, mas primeiro, vamos entender como ela funciona.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="co"># 1 Dimensão</span></a>
<a class="sourceLine" id="cb53-2" title="2">vetor &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb53-3" title="3">vetor[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1">vetor[<span class="dv">5</span>]</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1">vetor[<span class="op">-</span><span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1]  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">vetor[<span class="op">-</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7 8 9</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">vetor[vetor <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>## [1]  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">vetor[vetor <span class="op">!=</span><span class="st"> </span><span class="dv">8</span>]</a></code></pre></div>
<pre><code>## [1]  1  2  3  4  5  6  7  9 10</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">vetor[vetor <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>vetor <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span>] <span class="co"># Várias condições ao mesmo tempo</span></a></code></pre></div>
<pre><code>## [1] 6 7</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1"><span class="co"># 2 Dimensões</span></a>
<a class="sourceLine" id="cb67-2" title="2">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">vetor1 =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb67-3" title="3">                 <span class="dt">vetor2 =</span> LETTERS[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])</a>
<a class="sourceLine" id="cb67-4" title="4">df[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>##    vetor1
## 1       1
## 2       2
## 3       3
## 4       4
## 5       5
## 6       6
## 7       7
## 8       8
## 9       9
## 10     10</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">df[<span class="dv">2</span>]</a></code></pre></div>
<pre><code>##    vetor2
## 1       A
## 2       B
## 3       C
## 4       D
## 5       E
## 6       F
## 7       G
## 8       H
## 9       I
## 10      J</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">df[<span class="dv">1</span>, <span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1">df[<span class="dv">10</span>, <span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] J
## Levels: A B C D E F G H I J</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1">df[<span class="dv">6</span><span class="op">:</span><span class="dv">10</span>, ] <span class="co"># Todas as colunas</span></a></code></pre></div>
<pre><code>##    vetor1 vetor2
## 6       6      F
## 7       7      G
## 8       8      H
## 9       9      I
## 10     10      J</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">df[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] A B C D E
## Levels: A B C D E F G H I J</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">df[df<span class="op">$</span>vetor1 <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>, ] <span class="co"># Note o uso da vírgula</span></a></code></pre></div>
<pre><code>##    vetor1 vetor2
## 6       6      F
## 7       7      G
## 8       8      H
## 9       9      I
## 10     10      J</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">df[df<span class="op">$</span>vetor1 <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">&amp;</span><span class="st"> </span>df<span class="op">$</span>vetor2 <span class="op">!=</span><span class="st"> &quot;G&quot;</span>, ]</a></code></pre></div>
<pre><code>##    vetor1 vetor2
## 6       6      F
## 8       8      H
## 9       9      I
## 10     10      J</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">df[df<span class="op">$</span>vetor1 <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span> <span class="op">|</span><span class="st"> </span>df<span class="op">$</span>vetor1 <span class="op">&gt;</span><span class="st"> </span><span class="dv">8</span>, ]</a></code></pre></div>
<pre><code>##    vetor1 vetor2
## 1       1      A
## 2       2      B
## 3       3      C
## 4       4      D
## 9       9      I
## 10     10      J</code></pre>
<p>Basicamente, ela funciona na lógica <code>x[i, j, k, ...]</code>, onde x é o nosso objeto e i, j e as outras letras representam as dimensões desse objeto. Quando usamos números (índices), ele acessa as partes do objeto pela sua posição, mas quando utilizamos testes lógicos (&gt; &lt; &gt;= &lt;= &amp; | == !=, etc), ele extrai as partes do objeto cujo resultado do teste é <code>TRUE</code> e exclui os restantes. Lembrem-se que a chamada sempre deve respeitar as dimensões do objeto, por isso é obrigatório o uso da vírgula quando usar <code>[]</code>em <code>data.frames</code>, mesmo que queiramos utilizar todas as colunas. Vamos ver outro exemplo com nosso extrato do censo.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1"><span class="co"># Selecionando casos</span></a>
<a class="sourceLine" id="cb85-2" title="2">dado[dado<span class="op">$</span>MUNIC <span class="op">==</span><span class="st"> &quot;09502&quot;</span>, ] <span class="co"># Município de Campinas</span></a>
<a class="sourceLine" id="cb85-3" title="3">dado[dado<span class="op">$</span>MUNIC <span class="op">==</span><span class="st"> &quot;09502&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ] <span class="co"># População sem instrução</span></a>
<a class="sourceLine" id="cb85-4" title="4">dado[dado<span class="op">$</span>MUNIC <span class="op">==</span><span class="st"> &quot;09502&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>IDADE <span class="op">&gt;=</span><span class="st"> </span><span class="dv">18</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>IDADE <span class="op">&lt;=</span><span class="st"> </span><span class="dv">70</span>, ] <span class="co"># Eleitores obrigatórios</span></a>
<a class="sourceLine" id="cb85-5" title="5"></a>
<a class="sourceLine" id="cb85-6" title="6"><span class="co"># Selecionando variáveis</span></a>
<a class="sourceLine" id="cb85-7" title="7">dado[, <span class="kw">c</span>(<span class="st">&quot;UF&quot;</span>, <span class="st">&quot;MUNIC&quot;</span>, <span class="st">&quot;PESO&quot;</span>, <span class="st">&quot;RENDA&quot;</span>)]</a>
<a class="sourceLine" id="cb85-8" title="8">dado[, <span class="st">&quot;MUNIC&quot;</span>]</a>
<a class="sourceLine" id="cb85-9" title="9"></a>
<a class="sourceLine" id="cb85-10" title="10"><span class="co"># Selecionando casos e variáveis</span></a>
<a class="sourceLine" id="cb85-11" title="11">dado[dado<span class="op">$</span>MUNIC <span class="op">==</span><span class="st"> &quot;09502&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>IDADE <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>IDADE <span class="op">&lt;</span><span class="st"> </span><span class="dv">65</span>, <span class="co"># Casos [i]</span></a>
<a class="sourceLine" id="cb85-12" title="12">     <span class="kw">c</span>(<span class="st">&quot;PESO&quot;</span>, <span class="st">&quot;EDUC&quot;</span>, <span class="st">&quot;RENDA&quot;</span>)] <span class="co"># Variáveis [j]</span></a>
<a class="sourceLine" id="cb85-13" title="13"></a>
<a class="sourceLine" id="cb85-14" title="14"><span class="co"># Salva num outro objeto</span></a>
<a class="sourceLine" id="cb85-15" title="15">campinas &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>MUNIC <span class="op">==</span><span class="st"> &quot;09502&quot;</span>, ]</a>
<a class="sourceLine" id="cb85-16" title="16">campinas</a></code></pre></div>
<p>A utilização de variações do código acima nos permite selecionar casos e variáveis de praticamente qualquer tipo de banco de dado carregado em R. A lógica é a mesma. Os pacotes <code>data.table</code> e <code>dplyr</code> oferecem soluções alternativas para estas operações, ambos tem seus próprios méritos.</p>
</div>
<div id="criando-variáveis-derivadas-e-medidas-resumo" class="section level2">
<h2>Criando variáveis derivadas e medidas resumo</h2>
<p>A outra operação extremamente comum com bancos de dados é a criação de variáveis auxiliares a partir dos valores das variáveis originais. O salário mínimo vigente em 2010 era de R$ 510. Com isso, podemos fazer uma variável RENDA2.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1">dado<span class="op">$</span>RENDA2 &lt;-<span class="st"> </span>dado<span class="op">$</span>RENDA <span class="op">*</span><span class="st"> </span><span class="dv">510</span></a>
<a class="sourceLine" id="cb86-2" title="2">dado</a></code></pre></div>
<p>A mesma notação que utilizamos para referenciar variáveis <code>$</code> pode ser utilizada para criar novas variáveis também. Caso queiramos remover esta nova variável, podemos fazer:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">dado<span class="op">$</span>RENDA2 &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb87-2" title="2">dado</a></code></pre></div>
<p>Juntando um pouco esta seção a anterior, podemos calcular medidas resumo para casos selecionados. Por exemplo, podemos calcular a renda média para cada nível educacional distinto e por sexo (agora com pesos).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="kw">library</span>(questionr)</a>
<a class="sourceLine" id="cb88-2" title="2"></a>
<a class="sourceLine" id="cb88-3" title="3"><span class="co"># Educação</span></a>
<a class="sourceLine" id="cb88-4" title="4"></a>
<a class="sourceLine" id="cb88-5" title="5">grupo1 &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ]</a>
<a class="sourceLine" id="cb88-6" title="6"><span class="kw">wtd.mean</span>(grupo1<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo1<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.228536</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1">grupo2 &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;2&quot;</span>, ]</a>
<a class="sourceLine" id="cb90-2" title="2"><span class="kw">wtd.mean</span>(grupo2<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo2<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.653794</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1">grupo3 &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;3&quot;</span>, ]</a>
<a class="sourceLine" id="cb92-2" title="2"><span class="kw">wtd.mean</span>(grupo3<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo3<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 2.551411</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1">grupo4 &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;4&quot;</span>, ]</a>
<a class="sourceLine" id="cb94-2" title="2"><span class="kw">wtd.mean</span>(grupo4<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo4<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 7.785246</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1">grupo5 &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;5&quot;</span>, ]</a>
<a class="sourceLine" id="cb96-2" title="2"><span class="kw">wtd.mean</span>(grupo5<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo5<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.313933</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="co"># Sexo e educação</span></a>
<a class="sourceLine" id="cb98-2" title="2"></a>
<a class="sourceLine" id="cb98-3" title="3">grupo1m &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ]</a>
<a class="sourceLine" id="cb98-4" title="4"><span class="kw">wtd.mean</span>(grupo1m<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo1m<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.642161</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1">grupo1f &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;2&quot;</span>, ]</a>
<a class="sourceLine" id="cb100-2" title="2"><span class="kw">wtd.mean</span>(grupo1f<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo1f<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 0.8336615</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1">grupo2m &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ]</a>
<a class="sourceLine" id="cb102-2" title="2"><span class="kw">wtd.mean</span>(grupo2m<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo2m<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 2.233362</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1">grupo2f &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;2&quot;</span>, ]</a>
<a class="sourceLine" id="cb104-2" title="2"><span class="kw">wtd.mean</span>(grupo2f<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo2f<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.065546</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1">grupo3m &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;3&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ]</a>
<a class="sourceLine" id="cb106-2" title="2"><span class="kw">wtd.mean</span>(grupo3m<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo3m<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 3.404042</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">grupo3f &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;3&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;2&quot;</span>, ]</a>
<a class="sourceLine" id="cb108-2" title="2"><span class="kw">wtd.mean</span>(grupo3f<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo3f<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.731201</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">grupo4m &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;4&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ]</a>
<a class="sourceLine" id="cb110-2" title="2"><span class="kw">wtd.mean</span>(grupo4m<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo4m<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 10.42245</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">grupo4f &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;4&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;2&quot;</span>, ]</a>
<a class="sourceLine" id="cb112-2" title="2"><span class="kw">wtd.mean</span>(grupo4f<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo4f<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 5.539519</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1">grupo5m &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;5&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;1&quot;</span>, ]</a>
<a class="sourceLine" id="cb114-2" title="2"><span class="kw">wtd.mean</span>(grupo5m<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo5m<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1.670011</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">grupo5f &lt;-<span class="st"> </span>dado[dado<span class="op">$</span>EDUC <span class="op">==</span><span class="st"> &quot;5&quot;</span> <span class="op">&amp;</span><span class="st"> </span>dado<span class="op">$</span>SEXO <span class="op">==</span><span class="st"> &quot;2&quot;</span>, ]</a>
<a class="sourceLine" id="cb116-2" title="2"><span class="kw">wtd.mean</span>(grupo5f<span class="op">$</span>RENDA, <span class="dt">weights =</span> grupo5f<span class="op">$</span>PESO, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 0.9509576</code></pre>
<p>*** Caso você não tenha o pacote <code>questionr</code> basta instalar como indicado anteriormente ***</p>
</div>
<div id="revisando" class="section level2">
<h2>Revisando</h2>
<p>Falamos sobre tipos de bancos de dados, <strong>delimitados</strong> e <strong>largura fixa</strong>. Experimentamos ler bancos de dados de diferentes usando <code>read.table</code> e <code>read_fwf</code>. No caminho, instalamos nosso primeiro pacote. Fizemos também a escrita de bancos de dados utilizando <code>write.table</code>. Vimos como é possível visualizar os nossos dados utilizando medidas resumo e gráficos. Selecionamos casos e variaveis utilizando <code>[]</code>. Criamos variáveis derivadas utilizando <code>$</code>. Calculamos algumas medidas resumo após realizar a seleção de casos.</p>
</div>
<div id="exercícios" class="section level2">
<h2>Exercícios</h2>
<p>Há uma atividade no classroom para ser realizada pra quarta feira, envolvendo banco de dados.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
